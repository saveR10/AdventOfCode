using AOC;
using AOC.DataStructures.Clustering;
using AOC.Documents.LINQ;
using AOC.Model;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Numerics;
using System.Text.RegularExpressions;
using static System.Net.Mime.MediaTypeNames;

namespace AOC2023
{
    //DA SISTEMARE
    public class Day11 : Solver, IDay
    {
        public static String[] delimiters = { "\r\n", " " };
        public static String[] delimiter_space = { " " };
        public static String[] delimiter_line = { "\r\n" };
        public static String[] delimiter_equals = { "=" };
        public static String[] delimiter_parentesi = { "(", ")", "," };
        public string Universe_string = "";
        public List<string> ExpandedUniverse;
        public int nu;
        public int neur;
        public int neuc;

        public void Part1(object input, bool test, ref object solution)
        {
            test = false;

            if (!test)
            {
                Universe_string = @"..................................................................................................#..................#......................
............#...............................................#.........#........................................#............................
........................#................#.........#....................................................#......................#.......#....
....#............................................................#.............#............................................................
...............................................#....................................................#.......................................
...........................#..........................#.....................................................................................
..................................#...................................................................................#............#........
...................#.....................................................#....................................................#.........#...
.......#.................................#.......#...........#...............................#.............#.....#..........................
............................................................................................................................................
....................................................................#.........#........#....................................................
.#........#.....#.......#..............................................................................#.........................#..........
............................................#...........................................................................#...................
.......................................#.......................#............................................................................
.......#....................#............................#......................................................#...........................
.............#..............................................................#.....#......................#.................#................
...........................................................................................#................................................
.........................#............................#.....#...............................................................................
...................................#...................................#....................................................................
........................................................................................#............................#................#.....
..............#......#........#.........#.........................#................#........................................................
....#...........................................................................................#........................#..................
............................................................................................................................................
............................................................#...............#...........................#........................#..........
...................................................#.............................#.................#........................................
..#......................................................................................................................................#..
...................#....................#..............................#....................#...................#.........#.................
.......................................................#....................................................................................
......#.............................#..............................................#........................................................
...........................................................................#....................#.........#.................................
....................................................................................................................#.......................
#............................#............................................................#...................................#.......#.....
...................................................#............#...........................................................................
........................#................#........................................................#......................#..................
.......#.......................................#.................................................................#..........................
...........................................................#...............................................#................................
..#.................................#................#.......................................................................#..............
.............#....................................................#.........................................................................
.........................................................................#.........#.....#..........................#...............#.......
....................#.......#..................................................................#............................................
..................................#............#...............#............................................................................
.#.......#.............................#....................................#...............................................................
.........................#...........................#.............#................................#..........#.........#..................
.....#.........................#............................................................................................................
...............#............................................#...........#...................................................................
....................................#............................................#.....#.................#..........#........#..............
............................................................................................................................................
.#................#.................................................................................................................#.......
.........................................#..............#......................................#.....#......................................
.....#.....#...............#................................................................................................................
.................................#.........................................................................#.............#.......#..........
.............................................................................#.........................................................#....
.......................................#.......................#............................................................................
.................#.................................#.....#..........#.....................#.....................#...........................
............#..................................................................................................................#............
#...................................#.......................................................................................................
........#..............#..............................#..................................................................#..................
............................................#..............#................#......................................#........................
............................................................................................................................................
...................#......#.......................#..............#..........................................................#.....#........#
................................#............................................................#..............................................
......#...................................#.......................................#...............#.........................................
.....................................#........................#.......#......................................#.................#............
...........#...........#...............................#.............................................................................#......
.#...........................................#.........................................................................#....................
............................................................................................................................................
..................................................................#...............................................#.........................
..................................................................................#.......#................#................#...............
.........................#.......#...........................................#........................................................#.....
.....#..............#......................#.........#......#.........................................#.....................................
.....................................................................................................................#......................
....................................................................................#.....................................................#.
.............#.......................#......................................................................................................
.#......................#....................#.....................#.............................................................#..........
..................................................#.........................................................#...............................
.................................#........................................#.................................................................
.....................................................................................#..............................................#.......
............................................................................................................................................
.......#..................#.............................#........................#.................#.................#....................#.
..........................................................................................#.................................................
....................................#..........................#.........................................#.....................#............
......................#...................#..................................#....................................#.........................
....#........#.............................................................................................................#................
...............................#...............#......................#...............................#.....................................
.........#.......#.......#..................................................................................................................
.#.....................................................#....................................#.............#...........................#.....
...........................................#......#......................#.....................................#............................
.............................................................#..............................................................................
.............................#......#..........................................#............................................................
....#..................#............................................#...............................#.......................................
.........#.......#.............................#.........................................#..................#........#............#.........
.......................................................................................................................................#....
#.............................................................................................#.............................................
...................................#..............................#......................................................#..................
............................#...........................#................#.............................#.......#..............#.............
................................................#.........................................................................................#.
........#.............#.....................................................................................................................
....................................................................#......................................................#................
............................................................#........................................#......................................
.............#...................#.................................................#........................................................
.............................................................................#.......................................#......................
.........#...................#........#.........#........................................................#..............................#...
.#....................................................................#..................................................#.......#..........
................#...............................................................................................#...........................
......................#....................#............#...............................#...................................................
......#.......................................................#...................................#.........................................
.........................................................................#......#............................................#..............
..........#.........................................................#.......................................................................
............................#.........#................................................................#............#.......................
.......................#......................................................................#.............#...............................
................#.......................................#...............................................................................#...
#..............................#.....................................................#......................................................
............#....................................................................................#..............#.......#...................
.....................#..............#............................#..........................................................................
....#.............................................................................#.......................................................#.
.....................................................................................................#.....#.......................#........
...............#..............#............#.............................................#................................#.................
...........................................................#.........................................................#......................
.....................................................#...........................................#..............#...........................
...........#...............#.......................................#...............#........................................................
................................#...........................................................................................................
................#.........................#...............................#.............#.......................................#.....#.....
...............................................................#.............................#........#...............#.....................
..#.........................................................................................................................................
............................#......#................................#.............#...............#.........................................
...........#.........#.............................#.........................................................#..............................
.....#...................................................#..................#..................................................#...........#
..........................................#..............................................................#..................................
.....................................#......................................................................................................
.......................#......#............................................................#.......................#........#.....#.........
.#........#.......................................#.........................................................#...............................
................#................................................................#..........................................................
.........................................#.............................................#....................................................
...............................................#.......................................................................#........#...........
............................................................................................................................................
..............................#.........................#......#....................#.......................................................
.............................................................................................................#..............................
.................#.......................................................................................................................#..
........#................................#.........................#............#.........#......#........................#.................
........................#...............................................................................#...................................";
            }
            else
            {
                Universe_string = @"...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....";
            }
            nu = Universe_string.Split(delimiter_line, StringSplitOptions.None).Count();

            neur = nu;
            neuc = nu;

            List<string> Universe = new List<string>();
            ExpandedUniverse = new List<string>();
            for (int r = 0; r < nu; r++)
            {
                string RowUniverse = "";
                RowUniverse += Universe_string.Split(delimiter_line, StringSplitOptions.None)[r];
                Universe.Add(RowUniverse);
                ExpandedUniverse.Add(RowUniverse);
            }

            for (int r = 0; r < nu; r++)
            {
                if (!Universe[r].Contains("#"))
                {
                    ExpandUniverse(r, -1);
                }
            }

            for (int c = 0; c < nu; c++)
            {
                bool ToExpand = true;
                for (int r = 0; r < nu; r++)
                {
                    if (Universe[r][c].Equals('#'))
                    {
                        ToExpand = false;
                    }
                }
                if (ToExpand)
                {
                    ExpandUniverse(-1, c);
                }
            }

            List<int[]> Galaxies = new List<int[]>();
            for (int r = 0; r < neur; r++)
            {
                for (int c = 0; c < neuc; c++)
                {
                    if (ExpandedUniverse[r][c].Equals('#'))
                    {
                        Galaxies.Add(new int[2] { r, c });
                    }
                }
            }

            int DistanceSum = 0;
            for (int g1 = 0; g1 < Galaxies.Count(); g1++)
            {
                for (int g2 = g1 + 1; g2 < Galaxies.Count(); g2++)
                {
                    DistanceSum += EuclideanMeasure(Galaxies[g1], Galaxies[g2]);
                }
            }
        }
        public int EuclideanMeasure(int[] g1, int[] g2)
        {
            int vd = Math.Abs(g1[0] - g2[0]);
            int hd = Math.Abs(g1[1] - g2[1]);
            return hd + vd;
        }
        public int EuclideanMeasureB(int[] g1, int[] g2)
        {
            int vdP1 = Math.Abs(g1[0] - g2[0]);
            int hdP1 = Math.Abs(g1[1] - g2[1]);
            return hdP1 + vdP1;
        }

        public void ExpandUniverse(int r = -1, int c = -1)
        {
            if (r >= 0)
            {
                string newRow = "";
                for (int nc = 0; nc < neuc; nc++)
                {
                    newRow += ".";
                }
                ExpandedUniverse.Insert(r + (neur - nu), newRow);
                neur++;
            }
            if (c >= 0)
            {
                for (int nr = 0; nr < neur; nr++)
                {
                    ExpandedUniverse[nr] = ExpandedUniverse[nr].Insert(c + (neuc - nu), ".");
                }
                neuc++;
            }
        }
        public void ExpandUniverseB(int r = -1, int c = -1)
        {
            if (r >= 0)
            {
                ExpandedUniverse[r] = ExpandedUniverse[r].Replace(".", "*");
                //(r + (neur - nu), newRow);
                //ExpandedUniverse.Insert(r + (neur - nu), newRow);
                //neur++;
            }
            if (c >= 0)
            {
                for (int nr = 0; nr < neur; nr++)
                {
                    ExpandedUniverse[nr] = ExpandedUniverse[nr].Substring(0, c) + "*" + ExpandedUniverse[nr].Substring(c + 1, nu - c - 1);

                    //ExpandedUniverse[nr] = ExpandedUniverse[nr].Insert(c + (neuc - nu), "*");
                }
                //neuc++;
            }
        }
        public long EuclideanMeasureAccurate(int[] g1, int[] g2)
        {
            long AstronomicDistance = 1000000;//2;//100;//;//;//10;
            long hd = Math.Abs(g1[1] - g2[1]);
            int maxh = Math.Max(g1[1], g2[1]);
            int minh = Math.Min(g1[1], g2[1]);
            int maxv = Math.Max(g1[0], g2[0]);
            int minv = Math.Min(g1[0], g2[0]);
            int CounterAstronomic = 0;
            for (int i = 0; i < hd; i++)
            {
                if (ExpandedUniverse[g1[0]][minh + i].Equals('*'))
                {
                    CounterAstronomic++;
                }
            }

            while (CounterAstronomic != 0)
            {
                hd -= 1;
                hd += AstronomicDistance;
                CounterAstronomic--;
            }

            long vd = Math.Abs(g1[0] - g2[0]);
            CounterAstronomic = 0;
            for (int i = 0; i < vd; i++)
            {
                if (ExpandedUniverse[minv + i][g1[1]].Equals('*'))
                {
                    CounterAstronomic++;
                }
            }

            while (CounterAstronomic != 0)
            {
                vd -= 1;
                vd += AstronomicDistance;
                CounterAstronomic--;
            }
            return hd + vd;
        }


        public void Part2(object input, bool test, ref object solution)
        {
            test = false;

            if (!test)
            {
                Universe_string = @"..................................................................................................#..................#......................
............#...............................................#.........#........................................#............................
........................#................#.........#....................................................#......................#.......#....
....#............................................................#.............#............................................................
...............................................#....................................................#.......................................
...........................#..........................#.....................................................................................
..................................#...................................................................................#............#........
...................#.....................................................#....................................................#.........#...
.......#.................................#.......#...........#...............................#.............#.....#..........................
............................................................................................................................................
....................................................................#.........#........#....................................................
.#........#.....#.......#..............................................................................#.........................#..........
............................................#...........................................................................#...................
.......................................#.......................#............................................................................
.......#....................#............................#......................................................#...........................
.............#..............................................................#.....#......................#.................#................
...........................................................................................#................................................
.........................#............................#.....#...............................................................................
...................................#...................................#....................................................................
........................................................................................#............................#................#.....
..............#......#........#.........#.........................#................#........................................................
....#...........................................................................................#........................#..................
............................................................................................................................................
............................................................#...............#...........................#........................#..........
...................................................#.............................#.................#........................................
..#......................................................................................................................................#..
...................#....................#..............................#....................#...................#.........#.................
.......................................................#....................................................................................
......#.............................#..............................................#........................................................
...........................................................................#....................#.........#.................................
....................................................................................................................#.......................
#............................#............................................................#...................................#.......#.....
...................................................#............#...........................................................................
........................#................#........................................................#......................#..................
.......#.......................................#.................................................................#..........................
...........................................................#...............................................#................................
..#.................................#................#.......................................................................#..............
.............#....................................................#.........................................................................
.........................................................................#.........#.....#..........................#...............#.......
....................#.......#..................................................................#............................................
..................................#............#...............#............................................................................
.#.......#.............................#....................................#...............................................................
.........................#...........................#.............#................................#..........#.........#..................
.....#.........................#............................................................................................................
...............#............................................#...........#...................................................................
....................................#............................................#.....#.................#..........#........#..............
............................................................................................................................................
.#................#.................................................................................................................#.......
.........................................#..............#......................................#.....#......................................
.....#.....#...............#................................................................................................................
.................................#.........................................................................#.............#.......#..........
.............................................................................#.........................................................#....
.......................................#.......................#............................................................................
.................#.................................#.....#..........#.....................#.....................#...........................
............#..................................................................................................................#............
#...................................#.......................................................................................................
........#..............#..............................#..................................................................#..................
............................................#..............#................#......................................#........................
............................................................................................................................................
...................#......#.......................#..............#..........................................................#.....#........#
................................#............................................................#..............................................
......#...................................#.......................................#...............#.........................................
.....................................#........................#.......#......................................#.................#............
...........#...........#...............................#.............................................................................#......
.#...........................................#.........................................................................#....................
............................................................................................................................................
..................................................................#...............................................#.........................
..................................................................................#.......#................#................#...............
.........................#.......#...........................................#........................................................#.....
.....#..............#......................#.........#......#.........................................#.....................................
.....................................................................................................................#......................
....................................................................................#.....................................................#.
.............#.......................#......................................................................................................
.#......................#....................#.....................#.............................................................#..........
..................................................#.........................................................#...............................
.................................#........................................#.................................................................
.....................................................................................#..............................................#.......
............................................................................................................................................
.......#..................#.............................#........................#.................#.................#....................#.
..........................................................................................#.................................................
....................................#..........................#.........................................#.....................#............
......................#...................#..................................#....................................#.........................
....#........#.............................................................................................................#................
...............................#...............#......................#...............................#.....................................
.........#.......#.......#..................................................................................................................
.#.....................................................#....................................#.............#...........................#.....
...........................................#......#......................#.....................................#............................
.............................................................#..............................................................................
.............................#......#..........................................#............................................................
....#..................#............................................#...............................#.......................................
.........#.......#.............................#.........................................#..................#........#............#.........
.......................................................................................................................................#....
#.............................................................................................#.............................................
...................................#..............................#......................................................#..................
............................#...........................#................#.............................#.......#..............#.............
................................................#.........................................................................................#.
........#.............#.....................................................................................................................
....................................................................#......................................................#................
............................................................#........................................#......................................
.............#...................#.................................................#........................................................
.............................................................................#.......................................#......................
.........#...................#........#.........#........................................................#..............................#...
.#....................................................................#..................................................#.......#..........
................#...............................................................................................#...........................
......................#....................#............#...............................#...................................................
......#.......................................................#...................................#.........................................
.........................................................................#......#............................................#..............
..........#.........................................................#.......................................................................
............................#.........#................................................................#............#.......................
.......................#......................................................................#.............#...............................
................#.......................................#...............................................................................#...
#..............................#.....................................................#......................................................
............#....................................................................................#..............#.......#...................
.....................#..............#............................#..........................................................................
....#.............................................................................#.......................................................#.
.....................................................................................................#.....#.......................#........
...............#..............#............#.............................................#................................#.................
...........................................................#.........................................................#......................
.....................................................#...........................................#..............#...........................
...........#...............#.......................................#...............#........................................................
................................#...........................................................................................................
................#.........................#...............................#.............#.......................................#.....#.....
...............................................................#.............................#........#...............#.....................
..#.........................................................................................................................................
............................#......#................................#.............#...............#.........................................
...........#.........#.............................#.........................................................#..............................
.....#...................................................#..................#..................................................#...........#
..........................................#..............................................................#..................................
.....................................#......................................................................................................
.......................#......#............................................................#.......................#........#.....#.........
.#........#.......................................#.........................................................#...............................
................#................................................................#..........................................................
.........................................#.............................................#....................................................
...............................................#.......................................................................#........#...........
............................................................................................................................................
..............................#.........................#......#....................#.......................................................
.............................................................................................................#..............................
.................#.......................................................................................................................#..
........#................................#.........................#............#.........#......#........................#.................
........................#...............................................................................#...................................";
            }
            else
            {
                Universe_string = @"...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....";
            }
            nu = Universe_string.Split(delimiter_line, StringSplitOptions.None).Count();

            neur = nu;
            neuc = nu;

            List<string> Universe = new List<string>();
            ExpandedUniverse = new List<string>();
            for (int r = 0; r < nu; r++)
            {
                string RowUniverse = "";
                RowUniverse += Universe_string.Split(delimiter_line, StringSplitOptions.None)[r];
                Universe.Add(RowUniverse);
                ExpandedUniverse.Add(RowUniverse);
            }

            for (int r = 0; r < nu; r++)
            {
                if (!Universe[r].Contains("#"))
                {
                    ExpandUniverseB(r, -1);
                }
            }

            for (int c = 0; c < nu; c++)
            {
                bool ToExpand = true;
                for (int r = 0; r < nu; r++)
                {
                    if (Universe[r][c].Equals('#'))
                    {
                        ToExpand = false;
                    }
                }
                if (ToExpand)
                {
                    ExpandUniverseB(-1, c);
                }
            }

            List<int[]> Galaxies = new List<int[]>();
            for (int r = 0; r < neur; r++)
            {
                for (int c = 0; c < neuc; c++)
                {
                    if (ExpandedUniverse[r][c].Equals('#'))
                    {
                        Galaxies.Add(new int[2] { r, c });
                    }
                }
            }

            long DistanceSum = 0;
            for (int g1 = 0; g1 < Galaxies.Count(); g1++)
            {
                for (int g2 = g1 + 1; g2 < Galaxies.Count(); g2++)
                {
                    //DistanceSum += EuclideanMeasure(Galaxies[g1], Galaxies[g2]);
                    DistanceSum += EuclideanMeasureAccurate(Galaxies[g1], Galaxies[g2]);
                    //DistanceSum += ShortestPath(Galaxies[g1], Galaxies[g2]);

                }
            }
            Console.WriteLine(DistanceSum);
        }
        public int ShortestPath(int[] g1, int[] g2)
        {
            int AstronomicDistance = 100;
            int hd = Math.Abs(g1[1] - g2[1]);
            int vd = Math.Abs(g1[0] - g2[0]);
            int distance = hd + vd;
            int maxh = Math.Max(g1[1], g2[1]);
            int minh = Math.Min(g1[1], g2[1]);
            int maxv = Math.Max(g1[0], g2[0]);
            int minv = Math.Min(g1[0], g2[0]);
            for (int i = 0; i < hd; i++)
            {
                if (ExpandedUniverse[g1[0]][minh + i].Equals('*'))
                {
                    //     CounterAstronomicP1++;
                }
                if (ExpandedUniverse[g2[0]][minh + i].Equals('*'))
                {
                    //   CounterAstronomicP2++;
                }
            }
            return 0;
        }

    }
}
