using AOC;
using AOC.DataStructures.Clustering;
using AOC.Documents.LINQ;
using AOC.Model;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Numerics;
using System.Text.RegularExpressions;
using System.Threading.Tasks;
using static System.Net.Mime.MediaTypeNames;

namespace AOC2023
{
    //DA SISTEMARE
    public class Day12 : Solver, IDay
    {
        public static String[] delimiters = { "\r\n", " " };
        public static String[] delimiter_space = { " " };
        public static String[] delimiter_line = { "\r\n" };
        public static String[] delimiter_equals = { "=" };
        public static String[] delimiter_parentesi = { "(", ")", "," };
        public static String[] delimiter_comma = { "," };
        public string Records = "";
        public void Part1(object input, bool test, ref object solution)
        {
            test = true;

            if (!test)
            {
                Records = @"???#???.#??####? 5,1,5
???#????.#??????? 2,1,6
??.??#??#????.???. 1,10,1,1
#??#.???#..?? 4,1,1,1
?????.???..?? 1,2,2,1
????##?..??#?? 1,4,5
?#???.??##?#?. 3,1,3,1
.#.?#...##.??.? 1,2,2,1,1
????????.??? 4,2,1,1
???????##??#?#?????# 2,3,1,1,5
..??#.#??. 1,1,1
?????????.?##. 8,3
.#?.????????? 2,6,2
?.??#?????#???.?? 8,2
???..??????#?##???? 2,13
.??..????#?. 1,3,2
?#?.???####?.? 1,5,1
????#?#?#.?#??. 7,2,1
.?#????????.?..?#?? 9,2
?#??????#??#?. 2,1,1,2
?.???????##??? 1,8,2
.#.??#???????.????# 1,3,1,1,1,4
????.?????.?. 1,1,3,1
??.?#?????#??? 2,3,4,1
?.?#.?????#??.?? 2,6
.#?#?#???.?? 1,6,1
?##???????# 5,1,1
????????????????#.? 2,7,3,1
?###??##???????#? 5,2,4,1
???????.???.????.# 2,1,2,2,1
??##?#?.#..?.#??.?? 6,1,1,1,1,2
?????#??#???.?#????# 1,7,1,3,1,1
.?.???#?????? 1,7,1
??.#???.#? 1,1
????.#?.#?. 1,1,1
????..#?????#?. 1,4,2
#?#??#.??.#?#?#??.? 1,4,1,1,3,1
?###?#????.???.??#? 6,1,3,2
##?????#?#??#.?????? 3,6,2,1,1,1
?.???#?#??#?#? 1,2,1,4
??.?#?###??????#?? 2,1,5,1,1,1
?.#???.??.#.? 1,1,1,1
.??##??#???. 4,4
??????##?## 1,3,2
??.?#??.#??## 1,3,1,3
??????????? 3,1,1
?.??#???.??#.??? 6,1,1,1
???#??###????? 1,6,1
???.#??.???????. 2,5
??#???????##??##?. 2,4,7
????##.?.???.??.#? 5,3,1,1
?#?????.##??.??#?#?? 1,3,2,1,6
.????????#???.????# 5,6,3
.?.????.?. 1,2,1
?.??#.#?#??##?????? 1,1,13
????.?##????.??.#.? 2,3,1,1,1,1
????.???????####???. 1,8
?.???.????#??.. 3,4
?????????#??????# 1,8,2,1
.??#???#..? 2,1
.?#???..??# 2,2
.??#???#?#?..?.?# 9,1,2
????##?.???#?#? 1,3,4
??####???.??# 7,3
?#?#?????#????# 3,1,1,1,2
.#.???#????? 1,5,1,1
.???#????#??#??????? 12,1,1,1
?????#.?#??#????? 1,3,2,1,2
?.??#?.??.??? 1,3,2,3
??##?.???? 5,1,1
??###?#?????#?. 4,4,2
??##?????#?#??.?##?. 12,3
??????##??#....# 7,1,1
????#???#?#.#?.? 1,6,1,1,1
???????###? 1,1,5
?#?????#???.?# 3,3,2
?#???????#?#?#. 1,1,3,1,1
#???#??.??#??? 2,1,6
??.??.???#?.?#?#??? 1,1,4,5
..?????#???##??? 1,7,1
??#?????.??????.?# 4,3,2,1
#?????#?#.??????? 7,1,1,1,2
?.#.?.#??.???? 1,1,2,3
#??#??#?##??????## 2,7,1,4
.#.?.???.? 1,1,1
????##?.?????.. 3,2
?#?#???#?#?????# 3,10
?#??#.###???????? 5,4,5
#?.#?.?##??###???? 1,2,3,5,1
???????#?.#. 1,1,1,1
.?????##?????? 1,9
??.#..????? 1,1,2
?#?#.?#?#???# 1,1,5,1
?##?????#? 6,1
??.?????#### 1,1,6
???.??#??#???.?##? 1,8,4
.?#.?????????? 1,5
????????#?#?#?? 8,1,2
.?.#???#??? 1,5,1
??.??#??????#?##?#?? 1,1,14
##?#.??..???? 4,1,1,1
..???.???.. 2,3
??.??#?.??. 3,2
.?#.??????????#??..# 1,1,7,1,1,1
??#.???????#???# 3,1,1,2,2
????.????? 1,1,3
???????#?.???#??#?? 1,2,3,2
.?..??#??#???#.? 1,8,1,1
????.?.##?.#??????? 3,2,4,2
???##??..????. 1,2,3
??.#.??.?##?#???# 2,1,1,6,1
?#??#?#?#??.??##.? 9,3
?.????##?????#?? 9,1
????#.??#.?? 3,2,1
?##.#?.???#.???#??? 2,1,1,1,6
???#.???#???????#??? 3,3,1,2,2
?????????.? 3,2
??#?.?##.??????? 1,2,3,1,4
??????????##?????? 5,1,5,1
?????????#??#?.. 1,3,3,2
.????#?.?? 3,2
.???#?????? 2,2
.?????##???#.?#? 2,6,1
?.?#.???????? 1,2,1,1
??.?#?#?.?? 1,3,1
??##?.?.???????.??#? 4,1,2,2
..?????.??# 2,2
????..#??#.???? 1,1,1,2,1
.????###??#?#?.?#? 10,2
#??#?#?.??????? 1,4,1,3
?.#???????????? 1,4,2,1,1
?#???..?.??? 3,1,1,1
?.????????????? 5,1,1
.??.?.???. 1,3
..??...#??? 2,1
???#???#??.?#.????. 1,7,1,2
?.??????##? 1,2,2
??.?#???#..??.?? 1,2,1,2,1
??#???###?#?.#?????. 4,6,2,3
?.##??.???##.? 2,5
?.?????#??????.??.?? 3,1
##??##?#??? 8,1
.?..?.????#????????? 1,1,5,2,2
.?#?#?#?##?.# 3,1,3,1
?#?????#?.???#?? 3,2,4
?.#?#????? 1,1,1
????.??#.??...???? 3,3,2,1,1
??.?#??.?.??.??? 2,1,1,1,3
.??????#.???####?... 7,5
.?????##..???#. 1,1,2,1,1
?#??#...???.? 4,2
?????###?? 1,3
.###????#.#. 8,1
?????#??.? 1,5,1
?#??????..?##?? 4,5
???#??##?..###?? 2,1,2,3,1
#.??.?#?????.#?????# 1,2,5,4,1
#??##???#?#?? 5,5
#?#??.?..? 4,1
???????#????.??#?# 3,2,1,1,1,1
.?.???????####????.. 1,1,1,1,5,1
?????..?##???#???? 4,7,1,1
???#?#??.?.??? 4,1,1,1
???.????#???? 6,1
.??#????#? 2,4
???#?#????#?#.???? 11,2,1
????#??????## 1,10
.??.#.#?#????#?.# 1,1,1,4,1
?..??#??#????# 1,2,3,1
.?.?#?#????.?. 1,6,1,1
??#?#???#? 1,5
?.????#??????##???# 2,2,2,3,1
??.?#.?..?? 2,2
?.#??##????.????#?.# 8,2,2,1
#??#??????? 2,1,2
.???##??.#????? 1,4,2,1
???#????..??#???#?#? 1,1,1,1,9
#??????.?. 2,3
#???#????.??? 7,1
?????.??..#????? 1,1,1,3,1
?#?#?#.???? 1,3,2
??.??##???? 1,3,1
?#??????#?#?#?.??#? 1,1,7,2
?????#???.#?#??#.??? 1,3,6,2
.???.??#?..# 1,3,1
????.?.#???????? 1,1,1,1,4
..??#??#?#.??##?? 7,3
?.???.?????? 2,1,2
???#????????..? 4,1
???????#.?.?#?.?. 8,2
?????#??.?? 6,2
?.??#?????##?? 3,8
#???##????# 7,1
##?#?#????#.#???#? 6,2,5
????.????##? 1,3,2
?.?##?.???#? 4,5
?????#.?#??.???## 3,1,4,1,2
.#?#???#????????#?? 5,5,3
????.????? 3,3
?#????#??#??????. 7,2,1
.??#.#.?##?#??? 1,1,1,4,1
????#???..? 3,4
?#?.???#???????## 1,1,1,7
?#??..#?#?? 2,3
??????#???##?#.?.?? 14,1,1
???.???..?.??? 3,2,1,3
?#?#?#?#????? 2,1,1,5
???????##??#? 1,1,6
???##?#?##??#..????? 1,10,1,1
??#??#.#??????? 5,6
??##?.?##???? 1,2,3,2
.?#?#???.??.??##?.?? 2,1,1,1,5,2
??#??#??#???.??.. 1,1,7,1
??..???#????##????# 1,1,2,7,1
.#??#?????##???..# 6,5,1
#.?.???.???#??..? 1,1,1,4,1
??#????#?#?#?? 2,1,6
?#?#?????.????##??#. 5,1,8
??.#???#..?? 1,1,1,1
#?#.?#?.???#? 1,1,3,3
???#???#?????##?.?? 1,1,1,9,1
?????#??#?????. 4,1,3
??#.?.???#??? 2,1,6
???#????#??.??? 8,1
??.????????????#? 3,4
##??#.#.#.??#???#? 5,1,1,7
???????#?##?????#??? 4,7,1,1,2
.?#..#.??#? 2,1,2
?.????.???????? 1,2
??.??###??#????.#? 10,2
???#???##??##?#.?. 8,2,1
?.???.?????? 1,1,5
??#?.#?#???..#?#? 1,1,1,2,3
.?.?##???#??#??# 1,3,4,1
.?#?.??.??????. 2,1,5
?#????#??? 1,4
.?????????????? 1,2,2
??##???#.???? 5,1,3
..##..?#?.?????? 2,3,3
???#?#??.?. 5,1
??.???##????.#????? 8,5
????#????..??? 4,1,1,1
.?.??##?#???? 1,5,3
???#????#####?.???? 14,3
#???#??##?#??.?#??? 1,1,5,2,3
.?#???#????##????? 1,11
?#.????#??????##??? 1,9,3
??##??????????##???? 4,9,1
.??????.#?#???#?.??? 4,7,2
??..?#?????.?.??. 1,7,1,1
???.??.?.??.#?### 2,2,1,2,5
??#????####??????. 2,10
.??#??#?#??#?? 1,1,6,1
.???..????#.??#??? 3,4,4
?????????#? 1,1,4
.#?????#??? 1,1,2
.??#?#???. 1,1,1
??..#?##??#?..? 1,1,6
??#.#??????#??.??#? 1,1,1,3,1,2
.?...??#.?? 1,2
?#?????#?.?.? 8,1
???#???#?#? 1,1,3
?.????#???#??##.??? 1,3,9,2
??##????????. 3,1,2
??????????? 1,2
..?.?##??????..?#? 9,3
??#?#?#.?.?#.#??.?#? 7,1,2,1,1,1
.?#???????#? 3,1,4
?????????????# 7,2,2
.#??.#.?#?## 1,1,4
???#??#??????? 1,8
#??.??#?#???#? 2,5,1
??#?###??#??. 6,2
?#?##??##?????#????? 17,1
??##??#??? 1,2,2
##??.??#?##?#?#??. 2,1,10
????##????? 1,2,2
?#??.?????#???? 2,1,2,2,1
#?.?#????#???#??#? 2,2,1,3,5
.#?##????.?###?? 8,3
#??#??#???.??.?? 1,2,2,2,1
..#?#..??#?##???#?#? 3,11
?#???.???.??????. 2,1,3,1,1
##??.??##????#.?.?? 2,6,1,2
.?.?#??#????.???? 5,1
##.???.?????.??. 2,1,4,2
?.???#?????? 1,3,4
????#??#?.? 2,1
???#?#?????.?###???? 1,4,1,1,7
?????????#?.? 3,2,1,1
??????..?.???? 2,1,1,1
#.?##?#???#??.??? 1,9,2
??##??#????#????? 4,1,4,1
.????.?#?????? 1,1,7
??#?..?????. 3,2,1
##?##???.?.????? 6,1,1,4
?#?#??#?...?. 1,5,1
??.????.???? 1,3,2
??.??#????.?? 3,1
.??.??????.??.?? 1,4,1,1,1
??.??????????..?? 1,4,1,1,1
..???..??? 1,1,3
??.??#?.?..?.##?## 1,1,1,1,5
#.?.???#?????#? 1,1,1,2,2
#??#???.?#?#? 5,4
?.????#????.?.# 6,2,1
.?????????.?? 1,1,2,1
?#?.??.??.????? 2,1,2,5
??.#.???#??##??? 2,1,8,1
?#??.#?#?????? 4,3,2,1
.????.#?.?????#?? 1,1,1,8
.#???###??... 1,5,1
.??#?#?##??? 1,1,1,3
???#???#?.????? 4,1,1,3,1
???.#.?#??#??? 1,1,5,1
##?.???##??. 2,2,3
??#???.?#????#?#.?? 5,3,4,1
??.??.?????. 1,2,1,1
?..?#?##?.????#?. 6,5
#????????? 1,2,3
?????.??????.?? 4,2,1
.???.?####? 1,1,6
.??.?#????......? 4,1
#????????#??? 1,1,3
?????.#.???#?#.????? 2,1,1,2,3,4
??.?#???#?#??????# 2,8,4
#???#?.???#?. 6,2
.???#.#???#??#..???? 1,1,1,5,1,1
?#?#????.????#?##? 7,1,3,2
#???.??????#??##? 2,1,1,1,4
?.??#..??? 2,1,1
?????#?.???.???# 1,2,2,1
.?#.???.??#..?? 1,3,1,1,1
.?#??#.?#?##?#???## 1,1,9,2
???##?#?????.. 6,2
????????##??#??##.? 5,9
?????#?#???? 1,4
.?????#????.????#??? 9,5
????.??#??#??? 3,9
??#????.#? 4,1
????##?.#????#.????? 6,1,4,1,1,1
?????.?#?#..?? 5,1,1,1
#??#????.????????#?# 2,3,1,10
??#.???#?. 1,3
?###????#.????????#? 7,1,1,4,2
?#.????##????. 1,8,1
..#.???#.#. 1,3,1
????.#?????#? 1,3,1,1
?.#.?????????#??#? 1,1,4,2,2,2
?#??.??#????? 1,1,1,5
.???##???#?#???.#? 7,1,1,1,1
?..?#?#??????#?#?.# 1,14,1
??.???.??? 1,2,3
?###?????#?? 4,2
#.?#.???##????? 1,2,7,1
.?#?##???#???#???? 2,11,1
#??#.??.??#????#?. 1,2,1,8
#?.???##?#???#??#? 2,1,2,1,5
?#.????????.?#??#? 2,1,5,3,2
???#?#????#?.???? 11,1
????..?#?#??..#?. 2,6,1
?.#??#?#???. 6,1
?.???????? 2,1
?.??????#?. 1,3
?????.????.????##?? 1,1,1,1,6
??#????????# 5,5
??#?..?#?? 3,4
??.????.????#?#???# 2,8
???#??#????? 1,6,2
???.?#????? 1,2,3
??????????.#?#??? 2,1,2,1,6
?#??????.?. 4,2
#.??.????.????#???. 1,1,1,1,8
?????????????#??## 1,9,1,3
???.?#?..?? 1,2,1
?##?..????????????? 3,11
???..??????? 3,1,1,1
.???????.??#? 4,2,1,1
#?#???#???###?? 1,1,8,1
?#??#????????.??#?? 4,1,2,5
?#?#?.?????? 3,1
?????#??#???? 2,1,2,2
#??????.?#.#??.?#??? 1,1,1,1,1,5
?#??#?#?????.##???.? 7,1,3,1
..?#??????#?.#.?? 4,3,1,1
????.??.??#??#?? 1,1,5
????#??????.?. 6,1
?#??##.???.????????? 6,3,4,1
???#????#?#???? 3,2,3
?????#??#???.? 5,1
??????..?? 1,4,1
..???#?#????.. 1,8
??.#??????.??.???? 2,2,1,1,2,2
#????.????#????????? 5,1,2,7
???#???.??#.??..? 2,4,1,1,1
??#.????.###? 1,1,1,3
?#???#???##?.?#??#.# 6,3,1,2,1
?#???#.??? 3,1,1
?##?.?.?##?# 3,5
?????#??????.#?? 8,1,1,1
???#???#?#### 1,1,1,4
??#??###?#..??. 4,5,2
..??????#?##? 1,7
#???.???##.???????? 1,1,1,2,1,5
??.#..?.#. 1,1,1
????#??#?.????.??? 7,1,1,1
.#???????.??#???. 2,5,3
.#?##.???..?.###? 1,2,3,1,4
?.#???.?.?##?????#?? 1,1,1,1,9
??????.????. 2,1,2
?#???.?#?#???? 4,4,1
#.??#?..??#?#??.# 1,1,1,7,1
?.#?????#.?#? 1,1,2,1
??#??????.???. 2,2,3
???.????#?.# 1,1,1,1
.?.??#?#??##?#.? 1,5,4
?.???????? 4,1
??#?.?????? 3,4
??.?#??###?# 1,9
#.????#.???#? 1,4,1,2
??.?.????#??. 2,7
???????#.??#???.?? 3,3,5,1
?????.???#??# 3,7
?###??#????.?? 7,1,1,1
.??#??.?##?? 5,4
??????????.??##?.?. 2,4,5
??##???.???.? 3,2
?#?.??.??#?# 1,2,3
??.???#????##?## 2,4,6
?????..#??#???#?# 1,1,1,4,4
#.?#?#????#??? 1,5,4
.????##?????????? 12,1
?##?#.??#.#.?? 5,2,1,1
###??.????###???? 5,8
#??#?#??????????# 1,4,3,3
??.#?????????.????#? 1,1,3,1,1,3
??.?#?#???.#???. 1,5,3
????????.##???.?#??? 5,1,2,1,5
..?###?#????.?.?? 9,1
.??????#??#????.?#?? 1,9,1,3
????###?????????#?? 6,8
#?###??????.??#??# 5,1,3,1,2
??????#??????# 2,2,6
??#??.#?#... 2,3
???#????????#?? 3,4
??.??#??#??##??? 1,11
?.??#????#??.???# 1,4,1,2,1
?##??#???.????.# 3,1,1,1,1
??##???#??.???.??#? 4,4,1,1,4
?.?.???.???????.?? 2,4
??.##?????. 2,1,1
?????#?##??? 1,1,4,2
?#?#????.#?.#?? 5,2,1,1,1
??????.?.??.#?. 4,1,1,2
??????#??????.?? 3,6
#?????#?.#???? 7,2,1
?#?#?##???.#?#????? 10,1,1,1,1
?#?????##?#??.#?? 2,1,1,5,3
#.????#???.?. 1,5,2,1
???????.??? 3,1,2
???.???..??#?? 1,3,5
?.##??????. 1,2,2
.#?#???.?.? 4,1
?######????.?# 8,2
?????????.????###??. 3,2,1,1,5
#?.#????.??# 2,1,2,2
???.???.#???.?#? 2,2,1,1,1
.???.##.???#???#. 1,2,4,1
?#.?????.?#?.??. 1,2,2,3
????.#?.?? 3,2,1
??##?#.?#?. 6,2
???.#??#.# 1,4,1
#?#????????#?#? 1,2,4,1,2
??????#????????.?. 1,6,2,1
??.?????..#? 1,1,1,1
??#?.?.??#????#???. 1,1,3,3
#???#?.???## 2,3,4
?????#??.???#?.??#?? 1,5,2,2,1,1
#??##?????#??????.? 1,14,1
?##???.??#?#???#? 6,2,6
?#??.##????#.? 3,3,1
??#.#??????? 1,1,2,1
????????#?# 1,5,1
?.???????? 1,1,1
???????#..?##. 2,2,1,3
?#.??.#?#??#?????? 1,1,1,1,4,2
????#??.??.?##???? 4,2
?????.?????#?#????? 5,4,4,1
#??.?#??.????? 2,3,4
.?..#????###??? 1,9
??#??#?##.?? 8,1
?..?#?#..??? 4,1
?#..????#???#??#? 1,7,4
..??.?????????? 1,1
#?.????????# 1,3,4
?#???##???..?##??? 8,5
.??.?.#?.#?#? 2,1,4
.?#.?##???#?##.??? 1,5,4,2
???#???#???# 3,6
..???.?#.???.?? 1,1
?#?????????##.? 2,1,4
??.#???#?? 2,2
?#??.??##?# 3,4
????????.? 1,1,1
.?#????#????##??#?? 1,12
?.???.??.?# 1,2
???#???##? 3,3
?#?#??.?#..###???.? 1,1,1,2,6,1
?..?#??????. 3,1
??.#?.??#?#? 1,5
?.##?#???.? 4,1,1
????.???#..? 2,1,2,1
??.??????#? 1,1,2
???.???.?????.???? 3,2,2,2,3
??????####???.???#? 12,2
???????????. 2,2
#??##...????.#?? 5,3,1
??..?????.????##. 2,1,2,1,3
??#?????.??? 3,1,1
???#?#.???# 4,2
?#??#????.?#?##?.?.? 3,1,1,6,1,1
?????#????##? 6,3
???#???#?#??? 1,1,6
?????..?#??#.? 1,2,4
???#?#?#.????#?##?# 1,1,1,1,10
???#?????#? 1,2,3
?.??.??????.? 1,1,2,2
????#????#??? 1,7,1
.?#.?.?#????.??###?? 2,5,5
?.??..????## 1,1,6
??.??.??.#?#?#??#. 1,1,1,5,1
???#?##?##?##??? 8,3
.???###???#?#?.???# 1,10,4
?.##?#????# 7,1
?#???#?.?.???? 4,1,1,2
?.?.?##???????. 5,1
.?????##?#?? 3,4,1
...????.?#???##.. 1,7
..????????.##?? 4,3,2
???????.???.? 2,1,1
.????????. 1,1,1
?.?#???#.????. 3,1,3
?.?.###.#??? 3,1
??????..???. 1,2,1,2
#??##??#?????. 1,3,6
??.???.?#. 1,1,1
?#.??????? 1,1,2
.#.??????#???? 1,5,5
?#??.????#? 2,1,1
????#?####..??#?#?#? 6,5
?#?.?#???.???#.? 2,2,2,4,1
#???.???????#?.?###? 1,1,1,3,5
??????#.??. 1,4
?.????#???##??.? 1,9
#????#.??#?#..####?? 1,1,1,1,1,6
.?#.????.?? 2,1,1
?????#????????????## 1,5,1,6
????##????.??..#. 1,3,1,1,1
?????###?????? 5,1,1
????.???????#?#?? 3,1,8
?????????.?.?#?###? 3,1,1,6
?#?????#???. 1,1,1,1
.?.#?#??#?#?#??#??#. 1,10,2,1
##?###?.?#? 6,1
????????##???#?? 1,1,7,3
??????????.??#??? 4,3
????#?#?.????#????#? 1,1,1,8,1
.#????#?#??. 1,1,5
?#??#??#??#??..? 9,3
#???#???#?????.? 6,1,3
??#?#?##????? 7,2
.??#?????. 2,1,1
???##?????.#?# 6,1,1
???#?#?#????#??.?? 7,1,1,1,1
??...????????#???..? 6,3
????.??#?#?.? 3,5,1
?????#??#??. 2,6
?#?.???#??#??#. 1,7,2
???#?#?????.????? 6,3,2
?#???#?????.?? 3,7,1
??#???.#.?. 5,1
???????.???.??? 2,3,2,3
?#.##????..?# 1,3,2,1
?#??#?.?#?#? 6,1,1
?????.?????. 3,5
??..?.?#????.?# 1,1,1,1,2
.?#?..?##?#?#? 1,7
??.??#??????## 7,2
?????????. 1,2
#?.??#??#?? 1,6
#???..????#????# 1,1,2,7
?#?????????##?? 1,6,3,1
?.#?#.?.???.? 1,1,1,3
???????????? 1,4,1
.????...##? 2,2
?????????? 2,1,1
?#.??????.? 1,6,1
.?.??.?#?? 1,1,4
???#?#??#??.?# 9,1
#????????.##??###.? 1,3,2,7
?#????#???. 4,1,1
??.???###???????.? 1,8,2,1
????????## 2,5
??.?#???#???.?? 1,1,1,1,2
?#?#..??.?#??.?.? 1,1,1,3,1
????..?#?. 1,1,1
.????#?.???????..?? 3,4
#?.?#.???#??#?#???? 2,1,3,1,4
???#?##?##.????#?? 1,5,1,2,1
..??.##??..?? 4,2
.#???..???.?????##?. 2,3,7
?#?#??????. 5,1
???.????#??#?#??.??? 1,1,8,2
????.#???#???#?? 1,1,7,1
?.??.??.#. 1,1
#???.#??.# 1,2,1
.????.##?.?? 1,1,2,1
????#?#??.??#??? 7,4
?????#.##???????? 4,2,2,1,1
???.?#?#?.??.? 1,4,2,1
???#???.?#?. 1,2,1,2
?.?..????#??..#? 1,2,1,1,2
????###??..???###??? 5,5
?#..??#?#?????? 1,7,1
#?..????#???????# 1,1,4,1,2
?#?????#?#?#????..# 12,1,1,1
#?#??#.???#??#?# 1,1,1,3,4
?.??#???#???#????? 1,1,1,8,1
??????.?#???? 4,1,2,1
?..#?#?#?#??#??????? 1,1,9,2,1
?...???#?#. 1,1,3
???.????.? 1,1,1
?????..??#?? 1,1,1,3
#???????.??#????##? 3,2,5,3
.?#??#??#?##?. 2,1,4
.?#???.#?? 3,3
.##?.?#..?? 3,1,1
??????#.??#. 1,3,1
??.?..#???? 1,3
??##.?#??#?#?#?#??? 2,2,9
?????????##????##?? 11,5
???#?.###.. 3,3
???#?.???.????.??# 5,2,1,2,3
??.???????????? 1,1,4,4
??.??????.?###??? 3,7
?#??#??##???????# 1,11,1
.#.??????..#?? 1,4,1
.?#??##.?? 5,1
#??#?????#??? 1,8
????????#??#. 1,9
??.?#??..?. 2,1,1
???#??#???.???#? 4,1,4
?#???.#??? 1,2,3
..#?#?????#??.????#? 9,5
?????????????# 11,1
??????#??#??#?? 1,2,9
?????#????#??? 3,3
#??????.?? 2,4
..??#??.?.??#??. 4,1
???##.?##???#?#? 3,4,3
?##.???#??????? 2,9
#.?.??????.????#???# 1,1,6,2,5
.?.##?##???##?? 5,2
?#???????.?#.#?#? 1,4,2,3
?.????#?????#??????# 1,6,1,2,2,1
##.????#???#. 2,1,2,3
.??#?..???.#?.?.?#?# 2,3,2,4
????????#??.????# 5,2,1,1,1
?#?????.#?#?# 5,1,1,1
??###.???##??#??? 5,5,2,1
?.??????????#??#???? 1,3,1,7,2
#??.???.?# 3,1,1
.??#?.?????.? 3,2,1,1
?????.???##??#???? 3,5,5
???..??###????#??. 1,12
??.???##?.????#?# 5,6
?.?#?????#????.? 1,7
?..??##??#???. 1,8
?#?#??.#.??? 5,1,1
.????.?..?##??.. 1,2,1,4
?##?#.?#.?#.???? 5,1,1,1
?##?????.?. 8,1
????#?##???# 1,1,4,2
??????????????? 6,2
???????##??????? 1,6,2
??????????#???. 2,3,3
????????..? 2,1
???????##????#?#??? 1,10,2
??#????#?????? 9,2
??#??????.? 4,1
?.???????? 1,1,1
???#?#.??#???? 3,3,2
.????.?#?#?##???#? 1,9,1
??###???##?#??????#? 6,9,1
??????####?.?.????.? 6,2
??#?.??#?#.#. 2,1,1,1
.?.???#??#####?#?. 1,1,1,8
??#??#???#??????#? 3,9,1,1
.#????###??#?#???? 1,10
?#??????...???#?..## 8,5,2
??#?.?##...?? 2,2
?##.?.??.?#?###? 2,2,5
?#??#????#?.? 3,7
??#?#??.???????.? 4,3,1,1
?#??#?.??...??#?? 5,5
??????#???. 1,3
.#???#?#..??? 7,1
.?.?#####? 1,7
??????#???#. 1,3,3
?...??#?.?.???. 4,2
.#.??.?#??? 1,2,2
???#??#??.##?.... 1,6,3
??#??..#?#.? 3,1,1
??###??????#??#??..? 4,10
???#.??#???.?.?#?? 1,1,6,3
?????#??#?.?#????.? 9,4
###.??????.??. 3,5,1
.??#???.??..??#???? 4,1,7
?????#?.##..???? 5,2,2
??#????#???#?.??#?? 13,3
?#???.????..#?? 1,4,2
??###?#?????????# 14,1
#???????###? 2,1,1,4
..???.??#.? 1,1
????.??#.? 2,1
???#??.#???###????? 4,8,1
.?.??.##????#??#?? 1,11
?.?#?????. 3,2
?.#???#???#??.?????? 7,3,5
?#?#.???#?#?#. 4,1,4,1
.????????? 1,1,2
???#..???###??? 4,5,1
???#????.? 3,1
?##?#???##???#??##?? 3,1,1,3,6
.?.??#?.???#?# 1,1,3,1
?.???.??????##?. 2,7
???##???#??#???#?.? 10,2
.???..#?####??#?#?? 1,1,7,5
?#???##?????#?.. 7,4
??#??.??.?. 1,2
????#?#??.. 3,1,1
???.??.?.?#?.#??. 2,2,3
#?????????.? 1,1,1,3
?????#?#??.?# 2,6,1
???#????????#?? 2,2,2
??.?.??##?##?? 1,1,8
.???????.#?..# 2,2,2,1
?#.#..??..?.?#?? 2,1,1,1,4
??????.#???#? 2,1,2,1
..???##????#???.?. 5,7
#???.?#..??????.?# 1,1,1,1,2,2
??.??.?.???? 1,1,1,3
??##???#???.?.?? 8,1
??#????.#? 3,1,1
#???###..#. 1,5,1
?..#???.?##???? 1,4
.????????#??##????? 6,1,7
.?#?#.???#??? 2,1,1,3
??.???#??#?#????#??? 1,13
????????#? 1,2,1
?????#????#??. 7,2,1
??????.#?#?#.? 3,5
...???##.?? 1,2
.?.?##??????.?. 1,4,1,1
?????#?.?#?#? 5,4
#?#??????..? 3,2
???????#?# 2,5
.????????. 1,3
???#??#?#?????.?. 1,1,4,1,1
????#??#?.#?#.## 4,3,2
?#?.?#????.#????#?# 2,3,1,1,4,1
.#??..???##?.?????#. 2,6,2,3
?????#?..##?##? 1,2,5
..#??#?????#??.??? 6,2,1
#???...??.?? 1,1,1,1
??????.???#??.????? 2,3,1,2,5
.#?..??????? 1,1,1,1
?????##?#?#? 2,7
???##????#??#???.?? 3,1,1,4,1
??#???.??..? 5,2,1
.??#?##??##????.?? 6,3,1,2
#?#???????#? 1,5,1,1
#.?????????? 1,5
.??..?????##??? 1,6
???###???##??.. 4,5
????????????? 1,5
?.#??#?????#????? 4,7
???????..?? 1,4,1
?.??.?#?###?#??#?.. 1,1,9,2
???..##?????#?#?.?? 2,6
?#..#??#??#?. 2,8
?#??????????? 3,6
?#??????????#.?? 1,1,2,3,1
###???????.?#??..? 7,1,2,1
???#??#?.? 4,2
?#.??#???### 1,2,4
???.????#? 1,1,2
????##??#?#???. 4,3,1
?????????????#?..? 1,1,2,4,1
????#??.?? 1,3,2
#?.?????#?. 1,5
?##??.?##????????? 4,2,3
?????..#.? 3,1,1
?###?.#??????.##?? 3,3,1,1,3
??.????..??#??# 1,2,1,2,1
##???????#????? 2,3,4
???.?.??#? 2,2
#??#??#..?????? 5,1,5
??.?????#?###.??.# 1,3,5,2,1
???#.???.#??? 3,1,2
?.???##???##???...? 5,6
???.?????.?..????... 1,1
????.?????.. 2,3
##.????#??###?#### 2,1,1,1,3,4
??#??#???#???## 9,3
????#?#.?? 5,2
.#??.??#??#? 1,1,7
#..?????.. 1,3
.????#?#.?.#?#.????? 7,3,2
.???..??#.#???? 1,1,1,1,1
???#???.???????#??## 7,5,2,2
##?#?#???????? 6,1,4
.????#????#????.??? 13,1,1
????.???#??? 1,2,1
.##??#.#.# 5,1,1
??????..?????. 5,2,1
?#?..#?##?.??. 2,5
#??.#.???.?#.?. 2,1,2,2,1
??.??#????#??? 1,1,7,1
?????.????#????.#??? 1,2,1,6,1,1
??.?#??????#??.?? 5,3,1
#.??#???.####?#??? 1,2,9
???.?.????#???###? 1,1,1,1,9
?#?????##??.?#??? 1,1,6,4
???#??##??. 1,1,4
..?##?#??#???? 3,4
???????.??? 1,1,1
?.#???.??????.?.#? 1,4,2,3,1,1
??#??#?#.?? 1,6,1
?.????..?.????? 2,3
?##?????#?#?##???? 14,1
???.?.??#????????? 2,1,3,1,2,1
?.???#.???.?.???.?? 1,3,3,1,1,1
.????####?#??#?? 1,12
?.#???#.#??????# 1,1,1,2,5
??#?#?.???? 2,1,3
????????...##??#?.?? 7,5
????????#?#???.? 1,4
???.????.?????#??#? 1,1,1,2,5
??????##?.??#? 5,1
#????#????#?#? 1,1,5
???#????#????.#???? 9,2,1,1
???#.???#???##??#? 2,1,2,3,1
?#???#???..?? 2,3,1,2
??????##?#?? 1,5
#?#??.?.???.??? 1,2,1,1,2
???????#??.??? 2,3,1,2
???#??#?#????? 2,6,2
?????#?#????.?.????? 1,5,1,1,2,1
?#??#?##?.???.??. 9,1,1
..#????????. 1,4,1
?.#??.##??? 3,3
.#?#????.????.?#? 3,2,3,2
??????#?.#? 6,2
???#????#???####??.? 3,1,9,1
?#????.????? 2,1,2
????#????. 1,7
??????###????? 2,5,3
.??#?##?#?#?# 6,5
???#???#???? 1,5,1
??????#?.#???.#? 7,2,2
.????##?##?#???#?? 1,1,2,8,1
?#?#??????????????? 8,3,1
???.??.?#? 1,1,1
#??..????? 1,1,1
?#??##?#?#?.#..? 2,3,1,1,1
?.#??????##??? 1,7
?????.?#??. 1,1,3
?.?????.???##..?. 4,5
???##??#?? 2,2
??#???#??#??#??#?? 3,1,1,2,4,1
.#????#???#?#?.? 2,2,2,2
#?##?.??.#???? 5,2,2,1
?.##???..?????##???. 5,10
???#???????? 1,3,1,2
???????#???#??? 2,4,4
.????????.??#????. 7,6
.?##?#?##?#? 5,5
???#??..##. 3,2
##?##???#????###.?? 2,4,8,1
???#.#..?##????#?#? 3,1,4,1,1
?????.?.###?????. 1,2,1,8
.??????#???? 4,2,1
?#.?##.??#??.? 1,3,4,1
??##??#????.??? 9,1
???.??.???.?#? 3,1,3,3
...#?????? 1,1,1
???#??#?..?#. 6,1
???#.??#?? 1,1,4
.?????#??? 1,1,1
???.??.?????#?? 2,1,1,3
.??##???.?#.? 4,1,1
???#?##?????.?? 1,9,1
.???#??????.?#? 1,2,2,1,3
.???#?.?.###???.?#?# 5,3,2,3
?#??.#.????#?##???? 2,1,2,4,1
??????????. 2,2,1
??????#???#????? 1,4,2,4
??..#?.#?????#?..? 1,1,8,1
?????..#?? 1,1,1
?????#?#?.?? 3,4
?????.#### 2,4
?##??.??## 3,1,3
??.?.#?????.? 1,1,1,2
?####?#?##??? 6,2,2
.??#??.?.???#? 1,3,2,1
#?#??????#?. 1,4,4
#.#????#?.????#??#?. 1,7,7
?????#.????????? 1,3,2,5
?#?.??#???? 2,2,3
?????#????#????.? 1,2,6,1
.???##?#???#?##?? 1,3,10
???????????#??##?.? 2,5
???.?#???? 1,1,1
#?????.#?????????#?. 1,1,1,8,2
#?????????????#??? 1,10,2,1
???#?#???# 1,7
?????#??#?##??##?? 1,5,6,1
?????????????? 1,1,1,5
.?.#.??.#??#???. 1,7
#?##????????. 4,1,2
???..????#?? 1,2
..?????????.##? 1,1,2,3
?#???##??.?.?.? 7,1,1
..??.???.? 1,3
??###?#?##?.?##?. 10,4
????????.??#?##??#?? 2,1,3,1,1,6
..???.???#?.??##??? 1,5,4
???#?.?#??.?????? 1,3,3,1,2
??###.?#??????.#?.? 5,2,4,2
.??????.?.#??.???? 5,1,1,3
##?##?#?.?? 8,1
?????#?..? 1,4,1
????##??#.?##???? 1,6,4
??..???#??#? 1,4,1
#?#????#???.#?. 1,1,4,1,2
?#??#???#???? 1,5,3
??.???##????#??#???# 1,1,12,1
??????#?#???#?????? 8,1,7
?????#..???#???# 4,3,1
????#.??#? 2,2
????.???.?? 3,2,1
??#????..?# 5,2
??#?#?#?#????????## 10,4
???????.#?#??# 1,1,4,1
??#??##???#??.. 3,8
??????#??.???? 1,2,2,3
.#??.??##..?.? 3,3,1
?????#?.??#.? 3,2
.???.##??#####???.? 2,2,5,2
??.??????.???#. 1,5,2,1
??#???????????#? 1,2,10
..##??#???.### 5,1,3
??.?????#?#?#???.#.? 1,1,7,1,1,1
???#???????#. 6,1
.?.?##?#????## 1,4,1,3
?????#???.???. 6,1
.#??.#??#?##?#??.? 1,1,1,7,1,1
???#?????#?#?? 3,4
..?##?????.???#????? 5,8
.?#?????.????.?. 1,1,1,3,1
??#??.##????? 4,2,4
?.#?#??#?? 1,4,1
???#?#?????????..?? 1,4,1,1,1,1
?#??????????.?.. 2,1,2,1,1
?#???????##?#????. 5,3,2,1
##?????#??# 5,4
.??.???#???###? 1,3,4
?##???#????.??#???#. 3,1,1,1,1,5
.?????###??#? 2,6
.??#?#????#??#.??#?? 12,3
???????##???#. 8,3
?#????##..???#? 8,1,2
.??#.#.?.???#?? 2,1,5
?###????????????#?? 6,3,7
??.??.?.#???.??##? 1,1,1,2,1,4
????.??.???? 1,1,1,1
?.#..?###..#?.? 1,4,2,1
????????????? 3,1,3,1
#??.????????? 2,1,3
#???#????????..?? 2,5,1,1
???#???????????? 8,2
??.??????##??? 1,6,1
..##????#???? 2,2,1,1
??##???#???????.? 1,3,6,1,1
.??##????# 5,1,1
.???????#?.? 1,1
?#???#?.#??..#...?# 4,1,1,1,1,1
.??.?#???###???. 1,4,6
?##????????.?###?#. 8,1,4,1";
            }
            else
            {
                Records = @"???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1";
            }

            long Arrangments = 0;

            for (int r = 0; r < Records.Split(delimiter_line, StringSplitOptions.None).Count(); r++)
            {
                List<int> Conditions = new List<int>();

                foreach (var condition in Records.Split(delimiter_line, StringSplitOptions.None)[r].Split(delimiter_space, StringSplitOptions.None)[1].Split(delimiter_comma, StringSplitOptions.None))
                {
                    Conditions.Add(int.Parse(condition));
                }

                Springs Springs = new Springs();
                Springs.Line = Records.Split(delimiter_line, StringSplitOptions.None)[r].Split(delimiter_space, StringSplitOptions.None)[0];
                for (int p = 0; p < Records.Split(delimiter_line, StringSplitOptions.None)[r].Split(delimiter_space, StringSplitOptions.None)[0].Count(); p++)
                {
                    Spring spring = new Spring(p);
                    spring.condition = Records.Split(delimiter_line, StringSplitOptions.None)[r].Split(delimiter_space, StringSplitOptions.None)[0][p];

                    if (p > 0) spring.PreviousSpring = Springs.springs.Where(s => s.position.Equals(p - 1)).FirstOrDefault();
                    Springs.springs.Add(spring);
                }

                foreach (Spring spring in Springs.springs)
                {
                    if (spring.position < Springs.springs.Count)
                    {
                        int p = spring.position;
                        spring.NextSpring = Springs.springs.Where(s => s.position.Equals(p + 1)).FirstOrDefault();
                    }
                }
                //Valorization of KGroup
                /*List<int> KGroup= new List<int>();
                List<int> BrokenGroup = new List<int>();
                List<int> UndefinedGroup = new List<int>();
                List<int> WorkingGroup = new List<int>(); 
                List<char> TypeOrder = new List<char>();*/
                int k = 1;
                foreach (Spring spring in Springs.springs)
                {
                    if (spring.NextSpring != null)
                    {
                        if (spring.condition == spring.NextSpring.condition) k++;
                        else if (spring.condition != spring.NextSpring.condition)
                        {
                            KGroup kGroup = new KGroup(spring.condition, k);
                            if (Springs.KGroup != null && Springs.KGroup.Count != 0) kGroup.PreviousKGroup = Springs.KGroup.Last();
                            kGroup.NextType = spring.NextSpring.condition;
                            Springs.KGroup.Add(kGroup);
                            if (spring.condition == '#') Springs.BrokenGroup.Add(k);
                            if (spring.condition == '.') Springs.WorkingGroup.Add(k);
                            if (spring.condition == '?') Springs.UndefinedGroup.Add(k);
                            Springs.TypeOrder.Add(spring.condition);
                            k = 1;
                        }
                    }
                    else if (spring.NextSpring == null)
                    {
                        KGroup kGroup = new KGroup(spring.condition, k);
                        if (Springs.KGroup != null && Springs.KGroup.Count != 0) kGroup.PreviousKGroup = Springs.KGroup.Last();
                        Springs.KGroup.Add(kGroup);
                        if (spring.condition == '#') Springs.BrokenGroup.Add(k);
                        if (spring.condition == '.') Springs.WorkingGroup.Add(k);
                        if (spring.condition == '?') Springs.UndefinedGroup.Add(k);
                        Springs.TypeOrder.Add(spring.condition);
                    }
                }

                FindPossibleArrangements(Springs, Conditions);


                var prova = "";
                //long arrangement= ModuliMatematici.GetBinCoeff(5,3);
            }
        }

        public void FindPossibleArrangements(Springs springs, List<int> Conditions)
        {
            int MissingBroken = Conditions.Sum(c => c) - springs.BrokenGroup.Sum(bg => bg);
            int Broken = springs.BrokenGroup.Sum(bg => bg);

            Substitute(springs.Line, MissingBroken);



        }
        public List<string> Substitute(string line, int MissingBroken)
        {
            List<string> possibilities = new List<string>();
            List<string> ToEvaluate = new List<string>();
            ToEvaluate.Add(line);
            while (ToEvaluate.Any(x => x.Contains("?")))
            {
                for (int i = 0; i < line.Length; i++)
                {
                    if (line[i] == '?')
                    {
                        //  ToEvaluate.RemoveAll(x=>x);
                        possibilities.AddRange(Duplicate(line, i));
                    }
                }

            }
            return possibilities;
        }
        public List<string> Duplicate(string line, int i)
        {
            List<string> strings = new List<string>();
            string stringA = line.Substring(0, i) + "#" + line.Substring(i + 1, line.Length - i - 1);
            string stringB = line.Substring(0, i) + "." + line.Substring(i + 1, line.Length - i - 1);
            strings.Add(stringA);
            strings.Add(stringB);
            return strings;
        }

        public class KGroup
        {
            public KGroup(char type, int dimension)
            {
                Type = type;
                this.dimension = dimension;
            }

            public char Type { get; set; }
            public KGroup PreviousKGroup { get; set; }
            public char NextType { get; set; }
            public int dimension { get; set; }
        }
        public class Springs
        {
            public string Line = "";
            public List<Spring> springs = new List<Spring>();
            public List<int> BrokenGroup = new List<int>();
            public List<int> UndefinedGroup = new List<int>();
            public List<int> WorkingGroup = new List<int>();
            public List<char> TypeOrder = new List<char>();
            public List<KGroup> KGroup = new List<KGroup>();
        }
        public class Spring
        {
            public Spring(int position)
            {
                this.position = position;
            }
            public int position { get; set; }
            public char condition { get; set; }
            public Spring PreviousSpring { get; set; }
            public Spring NextSpring { get; set; }

        }
        public void Part2(object input, bool test, ref object solution)
        {
            var timer = new Stopwatch();
            timer.Start();

            //var outFile = "C:\\src\\Day12.txt";
            //File.WriteAllLines(outFile, new[] { "Day 12 Part 2"});

            string Records = @"???#???.#??####? 5,1,5
???#????.#??????? 2,1,6
??.??#??#????.???. 1,10,1,1
#??#.???#..?? 4,1,1,1
?????.???..?? 1,2,2,1
????##?..??#?? 1,4,5
?#???.??##?#?. 3,1,3,1
.#.?#...##.??.? 1,2,2,1,1
????????.??? 4,2,1,1
???????##??#?#?????# 2,3,1,1,5
..??#.#??. 1,1,1
?????????.?##. 8,3
.#?.????????? 2,6,2
?.??#?????#???.?? 8,2
???..??????#?##???? 2,13
.??..????#?. 1,3,2
?#?.???####?.? 1,5,1
????#?#?#.?#??. 7,2,1
.?#????????.?..?#?? 9,2
?#??????#??#?. 2,1,1,2
?.???????##??? 1,8,2
.#.??#???????.????# 1,3,1,1,1,4
????.?????.?. 1,1,3,1
??.?#?????#??? 2,3,4,1
?.?#.?????#??.?? 2,6
.#?#?#???.?? 1,6,1
?##???????# 5,1,1
????????????????#.? 2,7,3,1
?###??##???????#? 5,2,4,1
???????.???.????.# 2,1,2,2,1
??##?#?.#..?.#??.?? 6,1,1,1,1,2
?????#??#???.?#????# 1,7,1,3,1,1
.?.???#?????? 1,7,1
??.#???.#? 1,1
????.#?.#?. 1,1,1
????..#?????#?. 1,4,2
#?#??#.??.#?#?#??.? 1,4,1,1,3,1
?###?#????.???.??#? 6,1,3,2
##?????#?#??#.?????? 3,6,2,1,1,1
?.???#?#??#?#? 1,2,1,4
??.?#?###??????#?? 2,1,5,1,1,1
?.#???.??.#.? 1,1,1,1
.??##??#???. 4,4
??????##?## 1,3,2
??.?#??.#??## 1,3,1,3
??????????? 3,1,1
?.??#???.??#.??? 6,1,1,1
???#??###????? 1,6,1
???.#??.???????. 2,5
??#???????##??##?. 2,4,7
????##.?.???.??.#? 5,3,1,1
?#?????.##??.??#?#?? 1,3,2,1,6
.????????#???.????# 5,6,3
.?.????.?. 1,2,1
?.??#.#?#??##?????? 1,1,13
????.?##????.??.#.? 2,3,1,1,1,1
????.???????####???. 1,8
?.???.????#??.. 3,4
?????????#??????# 1,8,2,1
.??#???#..? 2,1
.?#???..??# 2,2
.??#???#?#?..?.?# 9,1,2
????##?.???#?#? 1,3,4
??####???.??# 7,3
?#?#?????#????# 3,1,1,1,2
.#.???#????? 1,5,1,1
.???#????#??#??????? 12,1,1,1
?????#.?#??#????? 1,3,2,1,2
?.??#?.??.??? 1,3,2,3
??##?.???? 5,1,1
??###?#?????#?. 4,4,2
??##?????#?#??.?##?. 12,3
??????##??#....# 7,1,1
????#???#?#.#?.? 1,6,1,1,1
???????###? 1,1,5
?#?????#???.?# 3,3,2
?#???????#?#?#. 1,1,3,1,1
#???#??.??#??? 2,1,6
??.??.???#?.?#?#??? 1,1,4,5
..?????#???##??? 1,7,1
??#?????.??????.?# 4,3,2,1
#?????#?#.??????? 7,1,1,1,2
?.#.?.#??.???? 1,1,2,3
#??#??#?##??????## 2,7,1,4
.#.?.???.? 1,1,1
????##?.?????.. 3,2
?#?#???#?#?????# 3,10
?#??#.###???????? 5,4,5
#?.#?.?##??###???? 1,2,3,5,1
???????#?.#. 1,1,1,1
.?????##?????? 1,9
??.#..????? 1,1,2
?#?#.?#?#???# 1,1,5,1
?##?????#? 6,1
??.?????#### 1,1,6
???.??#??#???.?##? 1,8,4
.?#.?????????? 1,5
????????#?#?#?? 8,1,2
.?.#???#??? 1,5,1
??.??#??????#?##?#?? 1,1,14
##?#.??..???? 4,1,1,1
..???.???.. 2,3
??.??#?.??. 3,2
.?#.??????????#??..# 1,1,7,1,1,1
??#.???????#???# 3,1,1,2,2
????.????? 1,1,3
???????#?.???#??#?? 1,2,3,2
.?..??#??#???#.? 1,8,1,1
????.?.##?.#??????? 3,2,4,2
???##??..????. 1,2,3
??.#.??.?##?#???# 2,1,1,6,1
?#??#?#?#??.??##.? 9,3
?.????##?????#?? 9,1
????#.??#.?? 3,2,1
?##.#?.???#.???#??? 2,1,1,1,6
???#.???#???????#??? 3,3,1,2,2
?????????.? 3,2
??#?.?##.??????? 1,2,3,1,4
??????????##?????? 5,1,5,1
?????????#??#?.. 1,3,3,2
.????#?.?? 3,2
.???#?????? 2,2
.?????##???#.?#? 2,6,1
?.?#.???????? 1,2,1,1
??.?#?#?.?? 1,3,1
??##?.?.???????.??#? 4,1,2,2
..?????.??# 2,2
????..#??#.???? 1,1,1,2,1
.????###??#?#?.?#? 10,2
#??#?#?.??????? 1,4,1,3
?.#???????????? 1,4,2,1,1
?#???..?.??? 3,1,1,1
?.????????????? 5,1,1
.??.?.???. 1,3
..??...#??? 2,1
???#???#??.?#.????. 1,7,1,2
?.??????##? 1,2,2
??.?#???#..??.?? 1,2,1,2,1
??#???###?#?.#?????. 4,6,2,3
?.##??.???##.? 2,5
?.?????#??????.??.?? 3,1
##??##?#??? 8,1
.?..?.????#????????? 1,1,5,2,2
.?#?#?#?##?.# 3,1,3,1
?#?????#?.???#?? 3,2,4
?.#?#????? 1,1,1
????.??#.??...???? 3,3,2,1,1
??.?#??.?.??.??? 2,1,1,1,3
.??????#.???####?... 7,5
.?????##..???#. 1,1,2,1,1
?#??#...???.? 4,2
?????###?? 1,3
.###????#.#. 8,1
?????#??.? 1,5,1
?#??????..?##?? 4,5
???#??##?..###?? 2,1,2,3,1
#.??.?#?????.#?????# 1,2,5,4,1
#??##???#?#?? 5,5
#?#??.?..? 4,1
???????#????.??#?# 3,2,1,1,1,1
.?.???????####????.. 1,1,1,1,5,1
?????..?##???#???? 4,7,1,1
???#?#??.?.??? 4,1,1,1
???.????#???? 6,1
.??#????#? 2,4
???#?#????#?#.???? 11,2,1
????#??????## 1,10
.??.#.#?#????#?.# 1,1,1,4,1
?..??#??#????# 1,2,3,1
.?.?#?#????.?. 1,6,1,1
??#?#???#? 1,5
?.????#??????##???# 2,2,2,3,1
??.?#.?..?? 2,2
?.#??##????.????#?.# 8,2,2,1
#??#??????? 2,1,2
.???##??.#????? 1,4,2,1
???#????..??#???#?#? 1,1,1,1,9
#??????.?. 2,3
#???#????.??? 7,1
?????.??..#????? 1,1,1,3,1
?#?#?#.???? 1,3,2
??.??##???? 1,3,1
?#??????#?#?#?.??#? 1,1,7,2
?????#???.#?#??#.??? 1,3,6,2
.???.??#?..# 1,3,1
????.?.#???????? 1,1,1,1,4
..??#??#?#.??##?? 7,3
?.???.?????? 2,1,2
???#????????..? 4,1
???????#.?.?#?.?. 8,2
?????#??.?? 6,2
?.??#?????##?? 3,8
#???##????# 7,1
##?#?#????#.#???#? 6,2,5
????.????##? 1,3,2
?.?##?.???#? 4,5
?????#.?#??.???## 3,1,4,1,2
.#?#???#????????#?? 5,5,3
????.????? 3,3
?#????#??#??????. 7,2,1
.??#.#.?##?#??? 1,1,1,4,1
????#???..? 3,4
?#?.???#???????## 1,1,1,7
?#??..#?#?? 2,3
??????#???##?#.?.?? 14,1,1
???.???..?.??? 3,2,1,3
?#?#?#?#????? 2,1,1,5
???????##??#? 1,1,6
???##?#?##??#..????? 1,10,1,1
??#??#.#??????? 5,6
??##?.?##???? 1,2,3,2
.?#?#???.??.??##?.?? 2,1,1,1,5,2
??#??#??#???.??.. 1,1,7,1
??..???#????##????# 1,1,2,7,1
.#??#?????##???..# 6,5,1
#.?.???.???#??..? 1,1,1,4,1
??#????#?#?#?? 2,1,6
?#?#?????.????##??#. 5,1,8
??.#???#..?? 1,1,1,1
#?#.?#?.???#? 1,1,3,3
???#???#?????##?.?? 1,1,1,9,1
?????#??#?????. 4,1,3
??#.?.???#??? 2,1,6
???#????#??.??? 8,1
??.????????????#? 3,4
##??#.#.#.??#???#? 5,1,1,7
???????#?##?????#??? 4,7,1,1,2
.?#..#.??#? 2,1,2
?.????.???????? 1,2
??.??###??#????.#? 10,2
???#???##??##?#.?. 8,2,1
?.???.?????? 1,1,5
??#?.#?#???..#?#? 1,1,1,2,3
.?.?##???#??#??# 1,3,4,1
.?#?.??.??????. 2,1,5
?#????#??? 1,4
.?????????????? 1,2,2
??##???#.???? 5,1,3
..##..?#?.?????? 2,3,3
???#?#??.?. 5,1
??.???##????.#????? 8,5
????#????..??? 4,1,1,1
.?.??##?#???? 1,5,3
???#????#####?.???? 14,3
#???#??##?#??.?#??? 1,1,5,2,3
.?#???#????##????? 1,11
?#.????#??????##??? 1,9,3
??##??????????##???? 4,9,1
.??????.#?#???#?.??? 4,7,2
??..?#?????.?.??. 1,7,1,1
???.??.?.??.#?### 2,2,1,2,5
??#????####??????. 2,10
.??#??#?#??#?? 1,1,6,1
.???..????#.??#??? 3,4,4
?????????#? 1,1,4
.#?????#??? 1,1,2
.??#?#???. 1,1,1
??..#?##??#?..? 1,1,6
??#.#??????#??.??#? 1,1,1,3,1,2
.?...??#.?? 1,2
?#?????#?.?.? 8,1
???#???#?#? 1,1,3
?.????#???#??##.??? 1,3,9,2
??##????????. 3,1,2
??????????? 1,2
..?.?##??????..?#? 9,3
??#?#?#.?.?#.#??.?#? 7,1,2,1,1,1
.?#???????#? 3,1,4
?????????????# 7,2,2
.#??.#.?#?## 1,1,4
???#??#??????? 1,8
#??.??#?#???#? 2,5,1
??#?###??#??. 6,2
?#?##??##?????#????? 17,1
??##??#??? 1,2,2
##??.??#?##?#?#??. 2,1,10
????##????? 1,2,2
?#??.?????#???? 2,1,2,2,1
#?.?#????#???#??#? 2,2,1,3,5
.#?##????.?###?? 8,3
#??#??#???.??.?? 1,2,2,2,1
..#?#..??#?##???#?#? 3,11
?#???.???.??????. 2,1,3,1,1
##??.??##????#.?.?? 2,6,1,2
.?.?#??#????.???? 5,1
##.???.?????.??. 2,1,4,2
?.???#?????? 1,3,4
????#??#?.? 2,1
???#?#?????.?###???? 1,4,1,1,7
?????????#?.? 3,2,1,1
??????..?.???? 2,1,1,1
#.?##?#???#??.??? 1,9,2
??##??#????#????? 4,1,4,1
.????.?#?????? 1,1,7
??#?..?????. 3,2,1
##?##???.?.????? 6,1,1,4
?#?#??#?...?. 1,5,1
??.????.???? 1,3,2
??.??#????.?? 3,1
.??.??????.??.?? 1,4,1,1,1
??.??????????..?? 1,4,1,1,1
..???..??? 1,1,3
??.??#?.?..?.##?## 1,1,1,1,5
#.?.???#?????#? 1,1,1,2,2
#??#???.?#?#? 5,4
?.????#????.?.# 6,2,1
.?????????.?? 1,1,2,1
?#?.??.??.????? 2,1,2,5
??.#.???#??##??? 2,1,8,1
?#??.#?#?????? 4,3,2,1
.????.#?.?????#?? 1,1,1,8
.#???###??... 1,5,1
.??#?#?##??? 1,1,1,3
???#???#?.????? 4,1,1,3,1
???.#.?#??#??? 1,1,5,1
##?.???##??. 2,2,3
??#???.?#????#?#.?? 5,3,4,1
??.??.?????. 1,2,1,1
?..?#?##?.????#?. 6,5
#????????? 1,2,3
?????.??????.?? 4,2,1
.???.?####? 1,1,6
.??.?#????......? 4,1
#????????#??? 1,1,3
?????.#.???#?#.????? 2,1,1,2,3,4
??.?#???#?#??????# 2,8,4
#???#?.???#?. 6,2
.???#.#???#??#..???? 1,1,1,5,1,1
?#?#????.????#?##? 7,1,3,2
#???.??????#??##? 2,1,1,1,4
?.??#..??? 2,1,1
?????#?.???.???# 1,2,2,1
.?#.???.??#..?? 1,3,1,1,1
.?#??#.?#?##?#???## 1,1,9,2
???##?#?????.. 6,2
????????##??#??##.? 5,9
?????#?#???? 1,4
.?????#????.????#??? 9,5
????.??#??#??? 3,9
??#????.#? 4,1
????##?.#????#.????? 6,1,4,1,1,1
?????.?#?#..?? 5,1,1,1
#??#????.????????#?# 2,3,1,10
??#.???#?. 1,3
?###????#.????????#? 7,1,1,4,2
?#.????##????. 1,8,1
..#.???#.#. 1,3,1
????.#?????#? 1,3,1,1
?.#.?????????#??#? 1,1,4,2,2,2
?#??.??#????? 1,1,1,5
.???##???#?#???.#? 7,1,1,1,1
?..?#?#??????#?#?.# 1,14,1
??.???.??? 1,2,3
?###?????#?? 4,2
#.?#.???##????? 1,2,7,1
.?#?##???#???#???? 2,11,1
#??#.??.??#????#?. 1,2,1,8
#?.???##?#???#??#? 2,1,2,1,5
?#.????????.?#??#? 2,1,5,3,2
???#?#????#?.???? 11,1
????..?#?#??..#?. 2,6,1
?.#??#?#???. 6,1
?.???????? 2,1
?.??????#?. 1,3
?????.????.????##?? 1,1,1,1,6
??#????????# 5,5
??#?..?#?? 3,4
??.????.????#?#???# 2,8
???#??#????? 1,6,2
???.?#????? 1,2,3
??????????.#?#??? 2,1,2,1,6
?#??????.?. 4,2
#.??.????.????#???. 1,1,1,1,8
?????????????#??## 1,9,1,3
???.?#?..?? 1,2,1
?##?..????????????? 3,11
???..??????? 3,1,1,1
.???????.??#? 4,2,1,1
#?#???#???###?? 1,1,8,1
?#??#????????.??#?? 4,1,2,5
?#?#?.?????? 3,1
?????#??#???? 2,1,2,2
#??????.?#.#??.?#??? 1,1,1,1,1,5
?#??#?#?????.##???.? 7,1,3,1
..?#??????#?.#.?? 4,3,1,1
????.??.??#??#?? 1,1,5
????#??????.?. 6,1
?#??##.???.????????? 6,3,4,1
???#????#?#???? 3,2,3
?????#??#???.? 5,1
??????..?? 1,4,1
..???#?#????.. 1,8
??.#??????.??.???? 2,2,1,1,2,2
#????.????#????????? 5,1,2,7
???#???.??#.??..? 2,4,1,1,1
??#.????.###? 1,1,1,3
?#???#???##?.?#??#.# 6,3,1,2,1
?#???#.??? 3,1,1
?##?.?.?##?# 3,5
?????#??????.#?? 8,1,1,1
???#???#?#### 1,1,1,4
??#??###?#..??. 4,5,2
..??????#?##? 1,7
#???.???##.???????? 1,1,1,2,1,5
??.#..?.#. 1,1,1
????#??#?.????.??? 7,1,1,1
.#???????.??#???. 2,5,3
.#?##.???..?.###? 1,2,3,1,4
?.#???.?.?##?????#?? 1,1,1,1,9
??????.????. 2,1,2
?#???.?#?#???? 4,4,1
#.??#?..??#?#??.# 1,1,1,7,1
?.#?????#.?#? 1,1,2,1
??#??????.???. 2,2,3
???.????#?.# 1,1,1,1
.?.??#?#??##?#.? 1,5,4
?.???????? 4,1
??#?.?????? 3,4
??.?#??###?# 1,9
#.????#.???#? 1,4,1,2
??.?.????#??. 2,7
???????#.??#???.?? 3,3,5,1
?????.???#??# 3,7
?###??#????.?? 7,1,1,1
.??#??.?##?? 5,4
??????????.??##?.?. 2,4,5
??##???.???.? 3,2
?#?.??.??#?# 1,2,3
??.???#????##?## 2,4,6
?????..#??#???#?# 1,1,1,4,4
#.?#?#????#??? 1,5,4
.????##?????????? 12,1
?##?#.??#.#.?? 5,2,1,1
###??.????###???? 5,8
#??#?#??????????# 1,4,3,3
??.#?????????.????#? 1,1,3,1,1,3
??.?#?#???.#???. 1,5,3
????????.##???.?#??? 5,1,2,1,5
..?###?#????.?.?? 9,1
.??????#??#????.?#?? 1,9,1,3
????###?????????#?? 6,8
#?###??????.??#??# 5,1,3,1,2
??????#??????# 2,2,6
??#??.#?#... 2,3
???#????????#?? 3,4
??.??#??#??##??? 1,11
?.??#????#??.???# 1,4,1,2,1
?##??#???.????.# 3,1,1,1,1
??##???#??.???.??#? 4,4,1,1,4
?.?.???.???????.?? 2,4
??.##?????. 2,1,1
?????#?##??? 1,1,4,2
?#?#????.#?.#?? 5,2,1,1,1
??????.?.??.#?. 4,1,1,2
??????#??????.?? 3,6
#?????#?.#???? 7,2,1
?#?#?##???.#?#????? 10,1,1,1,1
?#?????##?#??.#?? 2,1,1,5,3
#.????#???.?. 1,5,2,1
???????.??? 3,1,2
???.???..??#?? 1,3,5
?.##??????. 1,2,2
.#?#???.?.? 4,1
?######????.?# 8,2
?????????.????###??. 3,2,1,1,5
#?.#????.??# 2,1,2,2
???.???.#???.?#? 2,2,1,1,1
.???.##.???#???#. 1,2,4,1
?#.?????.?#?.??. 1,2,2,3
????.#?.?? 3,2,1
??##?#.?#?. 6,2
???.#??#.# 1,4,1
#?#????????#?#? 1,2,4,1,2
??????#????????.?. 1,6,2,1
??.?????..#? 1,1,1,1
??#?.?.??#????#???. 1,1,3,3
#???#?.???## 2,3,4
?????#??.???#?.??#?? 1,5,2,2,1,1
#??##?????#??????.? 1,14,1
?##???.??#?#???#? 6,2,6
?#??.##????#.? 3,3,1
??#.#??????? 1,1,2,1
????????#?# 1,5,1
?.???????? 1,1,1
???????#..?##. 2,2,1,3
?#.??.#?#??#?????? 1,1,1,1,4,2
????#??.??.?##???? 4,2
?????.?????#?#????? 5,4,4,1
#??.?#??.????? 2,3,4
.?..#????###??? 1,9
??#??#?##.?? 8,1
?..?#?#..??? 4,1
?#..????#???#??#? 1,7,4
..??.?????????? 1,1
#?.????????# 1,3,4
?#???##???..?##??? 8,5
.??.?.#?.#?#? 2,1,4
.?#.?##???#?##.??? 1,5,4,2
???#???#???# 3,6
..???.?#.???.?? 1,1
?#?????????##.? 2,1,4
??.#???#?? 2,2
?#??.??##?# 3,4
????????.? 1,1,1
.?#????#????##??#?? 1,12
?.???.??.?# 1,2
???#???##? 3,3
?#?#??.?#..###???.? 1,1,1,2,6,1
?..?#??????. 3,1
??.#?.??#?#? 1,5
?.##?#???.? 4,1,1
????.???#..? 2,1,2,1
??.??????#? 1,1,2
???.???.?????.???? 3,2,2,2,3
??????####???.???#? 12,2
???????????. 2,2
#??##...????.#?? 5,3,1
??..?????.????##. 2,1,2,1,3
??#?????.??? 3,1,1
???#?#.???# 4,2
?#??#????.?#?##?.?.? 3,1,1,6,1,1
?????#????##? 6,3
???#???#?#??? 1,1,6
?????..?#??#.? 1,2,4
???#?#?#.????#?##?# 1,1,1,1,10
???#?????#? 1,2,3
?.??.??????.? 1,1,2,2
????#????#??? 1,7,1
.?#.?.?#????.??###?? 2,5,5
?.??..????## 1,1,6
??.??.??.#?#?#??#. 1,1,1,5,1
???#?##?##?##??? 8,3
.???###???#?#?.???# 1,10,4
?.##?#????# 7,1
?#???#?.?.???? 4,1,1,2
?.?.?##???????. 5,1
.?????##?#?? 3,4,1
...????.?#???##.. 1,7
..????????.##?? 4,3,2
???????.???.? 2,1,1
.????????. 1,1,1
?.?#???#.????. 3,1,3
?.?.###.#??? 3,1
??????..???. 1,2,1,2
#??##??#?????. 1,3,6
??.???.?#. 1,1,1
?#.??????? 1,1,2
.#.??????#???? 1,5,5
?#??.????#? 2,1,1
????#?####..??#?#?#? 6,5
?#?.?#???.???#.? 2,2,2,4,1
#???.???????#?.?###? 1,1,1,3,5
??????#.??. 1,4
?.????#???##??.? 1,9
#????#.??#?#..####?? 1,1,1,1,1,6
.?#.????.?? 2,1,1
?????#????????????## 1,5,1,6
????##????.??..#. 1,3,1,1,1
?????###?????? 5,1,1
????.???????#?#?? 3,1,8
?????????.?.?#?###? 3,1,1,6
?#?????#???. 1,1,1,1
.?.#?#??#?#?#??#??#. 1,10,2,1
##?###?.?#? 6,1
????????##???#?? 1,1,7,3
??????????.??#??? 4,3
????#?#?.????#????#? 1,1,1,8,1
.#????#?#??. 1,1,5
?#??#??#??#??..? 9,3
#???#???#?????.? 6,1,3
??#?#?##????? 7,2
.??#?????. 2,1,1
???##?????.#?# 6,1,1
???#?#?#????#??.?? 7,1,1,1,1
??...????????#???..? 6,3
????.??#?#?.? 3,5,1
?????#??#??. 2,6
?#?.???#??#??#. 1,7,2
???#?#?????.????? 6,3,2
?#???#?????.?? 3,7,1
??#???.#.?. 5,1
???????.???.??? 2,3,2,3
?#.##????..?# 1,3,2,1
?#??#?.?#?#? 6,1,1
?????.?????. 3,5
??..?.?#????.?# 1,1,1,1,2
.?#?..?##?#?#? 1,7
??.??#??????## 7,2
?????????. 1,2
#?.??#??#?? 1,6
#???..????#????# 1,1,2,7
?#?????????##?? 1,6,3,1
?.#?#.?.???.? 1,1,1,3
???????????? 1,4,1
.????...##? 2,2
?????????? 2,1,1
?#.??????.? 1,6,1
.?.??.?#?? 1,1,4
???#?#??#??.?# 9,1
#????????.##??###.? 1,3,2,7
?#????#???. 4,1,1
??.???###???????.? 1,8,2,1
????????## 2,5
??.?#???#???.?? 1,1,1,1,2
?#?#..??.?#??.?.? 1,1,1,3,1
????..?#?. 1,1,1
.????#?.???????..?? 3,4
#?.?#.???#??#?#???? 2,1,3,1,4
???#?##?##.????#?? 1,5,1,2,1
..??.##??..?? 4,2
.#???..???.?????##?. 2,3,7
?#?#??????. 5,1
???.????#??#?#??.??? 1,1,8,2
????.#???#???#?? 1,1,7,1
?.??.??.#. 1,1
#???.#??.# 1,2,1
.????.##?.?? 1,1,2,1
????#?#??.??#??? 7,4
?????#.##???????? 4,2,2,1,1
???.?#?#?.??.? 1,4,2,1
???#???.?#?. 1,2,1,2
?.?..????#??..#? 1,2,1,1,2
????###??..???###??? 5,5
?#..??#?#?????? 1,7,1
#?..????#???????# 1,1,4,1,2
?#?????#?#?#????..# 12,1,1,1
#?#??#.???#??#?# 1,1,1,3,4
?.??#???#???#????? 1,1,1,8,1
??????.?#???? 4,1,2,1
?..#?#?#?#??#??????? 1,1,9,2,1
?...???#?#. 1,1,3
???.????.? 1,1,1
?????..??#?? 1,1,1,3
#???????.??#????##? 3,2,5,3
.?#??#??#?##?. 2,1,4
.?#???.#?? 3,3
.##?.?#..?? 3,1,1
??????#.??#. 1,3,1
??.?..#???? 1,3
??##.?#??#?#?#?#??? 2,2,9
?????????##????##?? 11,5
???#?.###.. 3,3
???#?.???.????.??# 5,2,1,2,3
??.???????????? 1,1,4,4
??.??????.?###??? 3,7
?#??#??##???????# 1,11,1
.#.??????..#?? 1,4,1
.?#??##.?? 5,1
#??#?????#??? 1,8
????????#??#. 1,9
??.?#??..?. 2,1,1
???#??#???.???#? 4,1,4
?#???.#??? 1,2,3
..#?#?????#??.????#? 9,5
?????????????# 11,1
??????#??#??#?? 1,2,9
?????#????#??? 3,3
#??????.?? 2,4
..??#??.?.??#??. 4,1
???##.?##???#?#? 3,4,3
?##.???#??????? 2,9
#.?.??????.????#???# 1,1,6,2,5
.?.##?##???##?? 5,2
?#???????.?#.#?#? 1,4,2,3
?.????#?????#??????# 1,6,1,2,2,1
##.????#???#. 2,1,2,3
.??#?..???.#?.?.?#?# 2,3,2,4
????????#??.????# 5,2,1,1,1
?#?????.#?#?# 5,1,1,1
??###.???##??#??? 5,5,2,1
?.??????????#??#???? 1,3,1,7,2
#??.???.?# 3,1,1
.??#?.?????.? 3,2,1,1
?????.???##??#???? 3,5,5
???..??###????#??. 1,12
??.???##?.????#?# 5,6
?.?#?????#????.? 1,7
?..??##??#???. 1,8
?#?#??.#.??? 5,1,1
.????.?..?##??.. 1,2,1,4
?##?#.?#.?#.???? 5,1,1,1
?##?????.?. 8,1
????#?##???# 1,1,4,2
??????????????? 6,2
???????##??????? 1,6,2
??????????#???. 2,3,3
????????..? 2,1
???????##????#?#??? 1,10,2
??#????#?????? 9,2
??#??????.? 4,1
?.???????? 1,1,1
???#?#.??#???? 3,3,2
.????.?#?#?##???#? 1,9,1
??###???##?#??????#? 6,9,1
??????####?.?.????.? 6,2
??#?.??#?#.#. 2,1,1,1
.?.???#??#####?#?. 1,1,1,8
??#??#???#??????#? 3,9,1,1
.#????###??#?#???? 1,10
?#??????...???#?..## 8,5,2
??#?.?##...?? 2,2
?##.?.??.?#?###? 2,2,5
?#??#????#?.? 3,7
??#?#??.???????.? 4,3,1,1
?#??#?.??...??#?? 5,5
??????#???. 1,3
.#???#?#..??? 7,1
.?.?#####? 1,7
??????#???#. 1,3,3
?...??#?.?.???. 4,2
.#.??.?#??? 1,2,2
???#??#??.##?.... 1,6,3
??#??..#?#.? 3,1,1
??###??????#??#??..? 4,10
???#.??#???.?.?#?? 1,1,6,3
?????#??#?.?#????.? 9,4
###.??????.??. 3,5,1
.??#???.??..??#???? 4,1,7
?????#?.##..???? 5,2,2
??#????#???#?.??#?? 13,3
?#???.????..#?? 1,4,2
??###?#?????????# 14,1
#???????###? 2,1,1,4
..???.??#.? 1,1
????.??#.? 2,1
???#??.#???###????? 4,8,1
.?.??.##????#??#?? 1,11
?.?#?????. 3,2
?.#???#???#??.?????? 7,3,5
?#?#.???#?#?#. 4,1,4,1
.????????? 1,1,2
???#..???###??? 4,5,1
???#????.? 3,1
?##?#???##???#??##?? 3,1,1,3,6
.?.??#?.???#?# 1,1,3,1
?.???.??????##?. 2,7
???##???#??#???#?.? 10,2
.???..#?####??#?#?? 1,1,7,5
?#???##?????#?.. 7,4
??#??.??.?. 1,2
????#?#??.. 3,1,1
???.??.?.?#?.#??. 2,2,3
#?????????.? 1,1,1,3
?????#?#??.?# 2,6,1
???#????????#?? 2,2,2
??.?.??##?##?? 1,1,8
.???????.#?..# 2,2,2,1
?#.#..??..?.?#?? 2,1,1,1,4
??????.#???#? 2,1,2,1
..???##????#???.?. 5,7
#???.?#..??????.?# 1,1,1,1,2,2
??.??.?.???? 1,1,1,3
??##???#???.?.?? 8,1
??#????.#? 3,1,1
#???###..#. 1,5,1
?..#???.?##???? 1,4
.????????#??##????? 6,1,7
.?#?#.???#??? 2,1,1,3
??.???#??#?#????#??? 1,13
????????#? 1,2,1
?????#????#??. 7,2,1
??????.#?#?#.? 3,5
...???##.?? 1,2
.?.?##??????.?. 1,4,1,1
?????#?.?#?#? 5,4
#?#??????..? 3,2
???????#?# 2,5
.????????. 1,3
???#??#?#?????.?. 1,1,4,1,1
????#??#?.#?#.## 4,3,2
?#?.?#????.#????#?# 2,3,1,1,4,1
.#??..???##?.?????#. 2,6,2,3
?????#?..##?##? 1,2,5
..#??#?????#??.??? 6,2,1
#???...??.?? 1,1,1,1
??????.???#??.????? 2,3,1,2,5
.#?..??????? 1,1,1,1
?????##?#?#? 2,7
???##????#??#???.?? 3,1,1,4,1
??#???.??..? 5,2,1
.??#?##??##????.?? 6,3,1,2
#?#???????#? 1,5,1,1
#.?????????? 1,5
.??..?????##??? 1,6
???###???##??.. 4,5
????????????? 1,5
?.#??#?????#????? 4,7
???????..?? 1,4,1
?.??.?#?###?#??#?.. 1,1,9,2
???..##?????#?#?.?? 2,6
?#..#??#??#?. 2,8
?#??????????? 3,6
?#??????????#.?? 1,1,2,3,1
###???????.?#??..? 7,1,2,1
???#??#?.? 4,2
?#.??#???### 1,2,4
???.????#? 1,1,2
????##??#?#???. 4,3,1
?????????????#?..? 1,1,2,4,1
????#??.?? 1,3,2
#?.?????#?. 1,5
?##??.?##????????? 4,2,3
?????..#.? 3,1,1
?###?.#??????.##?? 3,3,1,1,3
??.????..??#??# 1,2,1,2,1
##???????#????? 2,3,4
???.?.??#? 2,2
#??#??#..?????? 5,1,5
??.?????#?###.??.# 1,3,5,2,1
???#.???.#??? 3,1,2
?.???##???##???...? 5,6
???.?????.?..????... 1,1
????.?????.. 2,3
##.????#??###?#### 2,1,1,1,3,4
??#??#???#???## 9,3
????#?#.?? 5,2
.#??.??#??#? 1,1,7
#..?????.. 1,3
.????#?#.?.#?#.????? 7,3,2
.???..??#.#???? 1,1,1,1,1
???#???.???????#??## 7,5,2,2
##?#?#???????? 6,1,4
.????#????#????.??? 13,1,1
????.???#??? 1,2,1
.##??#.#.# 5,1,1
??????..?????. 5,2,1
?#?..#?##?.??. 2,5
#??.#.???.?#.?. 2,1,2,2,1
??.??#????#??? 1,1,7,1
?????.????#????.#??? 1,2,1,6,1,1
??.?#??????#??.?? 5,3,1
#.??#???.####?#??? 1,2,9
???.?.????#???###? 1,1,1,1,9
?#?????##??.?#??? 1,1,6,4
???#??##??. 1,1,4
..?##?#??#???? 3,4
???????.??? 1,1,1
?.#???.??????.?.#? 1,4,2,3,1,1
??#??#?#.?? 1,6,1
?.????..?.????? 2,3
?##?????#?#?##???? 14,1
???.?.??#????????? 2,1,3,1,2,1
?.???#.???.?.???.?? 1,3,3,1,1,1
.????####?#??#?? 1,12
?.#???#.#??????# 1,1,1,2,5
??#?#?.???? 2,1,3
????????...##??#?.?? 7,5
????????#?#???.? 1,4
???.????.?????#??#? 1,1,1,2,5
??????##?.??#? 5,1
#????#????#?#? 1,1,5
???#????#????.#???? 9,2,1,1
???#.???#???##??#? 2,1,2,3,1
?#???#???..?? 2,3,1,2
??????##?#?? 1,5
#?#??.?.???.??? 1,2,1,1,2
???????#??.??? 2,3,1,2
???#??#?#????? 2,6,2
?????#?#????.?.????? 1,5,1,1,2,1
?#??#?##?.???.??. 9,1,1
..#????????. 1,4,1
?.#??.##??? 3,3
.#?#????.????.?#? 3,2,3,2
??????#?.#? 6,2
???#????#???####??.? 3,1,9,1
?#????.????? 2,1,2
????#????. 1,7
??????###????? 2,5,3
.??#?##?#?#?# 6,5
???#???#???? 1,5,1
??????#?.#???.#? 7,2,2
.????##?##?#???#?? 1,1,2,8,1
?#?#??????????????? 8,3,1
???.??.?#? 1,1,1
#??..????? 1,1,1
?#??##?#?#?.#..? 2,3,1,1,1
?.#??????##??? 1,7
?????.?#??. 1,1,3
?.?????.???##..?. 4,5
???##??#?? 2,2
??#???#??#??#??#?? 3,1,1,2,4,1
.#????#???#?#?.? 2,2,2,2
#?##?.??.#???? 5,2,2,1
?.##???..?????##???. 5,10
???#???????? 1,3,1,2
???????#???#??? 2,4,4
.????????.??#????. 7,6
.?##?#?##?#? 5,5
???#??..##. 3,2
##?##???#????###.?? 2,4,8,1
???#.#..?##????#?#? 3,1,4,1,1
?????.?.###?????. 1,2,1,8
.??????#???? 4,2,1
?#.?##.??#??.? 1,3,4,1
??##??#????.??? 9,1
???.??.???.?#? 3,1,3,3
...#?????? 1,1,1
???#??#?..?#. 6,1
???#.??#?? 1,1,4
.?????#??? 1,1,1
???.??.?????#?? 2,1,1,3
.??##???.?#.? 4,1,1
???#?##?????.?? 1,9,1
.???#??????.?#? 1,2,2,1,3
.???#?.?.###???.?#?# 5,3,2,3
?#??.#.????#?##???? 2,1,2,4,1
??????????. 2,2,1
??????#???#????? 1,4,2,4
??..#?.#?????#?..? 1,1,8,1
?????..#?? 1,1,1
?????#?#?.?? 3,4
?????.#### 2,4
?##??.??## 3,1,3
??.?.#?????.? 1,1,1,2
?####?#?##??? 6,2,2
.??#??.?.???#? 1,3,2,1
#?#??????#?. 1,4,4
#.#????#?.????#??#?. 1,7,7
?????#.????????? 1,3,2,5
?#?.??#???? 2,2,3
?????#????#????.? 1,2,6,1
.???##?#???#?##?? 1,3,10
???????????#??##?.? 2,5
???.?#???? 1,1,1
#?????.#?????????#?. 1,1,1,8,2
#?????????????#??? 1,10,2,1
???#?#???# 1,7
?????#??#?##??##?? 1,5,6,1
?????????????? 1,1,1,5
.?.#.??.#??#???. 1,7
#?##????????. 4,1,2
???..????#?? 1,2
..?????????.##? 1,1,2,3
?#???##??.?.?.? 7,1,1
..??.???.? 1,3
??###?#?##?.?##?. 10,4
????????.??#?##??#?? 2,1,3,1,1,6
..???.???#?.??##??? 1,5,4
???#?.?#??.?????? 1,3,3,1,2
??###.?#??????.#?.? 5,2,4,2
.??????.?.#??.???? 5,1,1,3
##?##?#?.?? 8,1
?????#?..? 1,4,1
????##??#.?##???? 1,6,4
??..???#??#? 1,4,1
#?#????#???.#?. 1,1,4,1,2
?#??#???#???? 1,5,3
??.???##????#??#???# 1,1,12,1
??????#?#???#?????? 8,1,7
?????#..???#???# 4,3,1
????#.??#? 2,2
????.???.?? 3,2,1
??#????..?# 5,2
??#?#?#?#????????## 10,4
???????.#?#??# 1,1,4,1
??#??##???#??.. 3,8
??????#??.???? 1,2,2,3
.#??.??##..?.? 3,3,1
?????#?.??#.? 3,2
.???.##??#####???.? 2,2,5,2
??.??????.???#. 1,5,2,1
??#???????????#? 1,2,10
..##??#???.### 5,1,3
??.?????#?#?#???.#.? 1,1,7,1,1,1
???#???????#. 6,1
.?.?##?#????## 1,4,1,3
?????#???.???. 6,1
.#??.#??#?##?#??.? 1,1,1,7,1,1
???#?????#?#?? 3,4
..?##?????.???#????? 5,8
.?#?????.????.?. 1,1,1,3,1
??#??.##????? 4,2,4
?.#?#??#?? 1,4,1
???#?#?????????..?? 1,4,1,1,1,1
?#??????????.?.. 2,1,2,1,1
?#???????##?#????. 5,3,2,1
##?????#??# 5,4
.??.???#???###? 1,3,4
?##???#????.??#???#. 3,1,1,1,1,5
.?????###??#? 2,6
.??#?#????#??#.??#?? 12,3
???????##???#. 8,3
?#????##..???#? 8,1,2
.??#.#.?.???#?? 2,1,5
?###????????????#?? 6,3,7
??.??.?.#???.??##? 1,1,1,2,1,4
????.??.???? 1,1,1,1
?.#..?###..#?.? 1,4,2,1
????????????? 3,1,3,1
#??.????????? 2,1,3
#???#????????..?? 2,5,1,1
???#???????????? 8,2
??.??????##??? 1,6,1
..##????#???? 2,2,1,1
??##???#???????.? 1,3,6,1,1
.??##????# 5,1,1
.???????#?.? 1,1
?#???#?.#??..#...?# 4,1,1,1,1,1
.??.?#???###???. 1,4,6
?##????????.?###?#. 8,1,4,1";
            //var input = Records.ToList();
            var inputString = File.ReadLines("Input12.txt").ToList();

            var tasks = inputString.Select(line => Task.Factory.StartNew(() =>
            {
                var pattern = line.Split(' ')[0];
                var known = line.Split(' ')[1].Split(',').Select(int.Parse).ToList();

                //if (part == 2)
                {
                    var repeats = 5;
                    pattern = string.Join("?", Enumerable.Repeat(pattern, repeats));
                    known = Enumerable.Repeat(known, repeats).SelectMany(i => i).ToList();
                }

                timer = new Stopwatch();
                timer.Start();
                var arrangements = Arrangements(pattern, known);

                return (arrangements, timer.ElapsedMilliseconds);
            })).ToList();

            long result = 0;
            while (tasks.Count > 0)
            {
                var waitAny = Task.WaitAny(tasks.ToArray<Task>(), TimeSpan.FromSeconds(10));
                var printRemaining = true;
                if (waitAny >= 0)
                {
                    var (arrangements, elapsedMilliseconds) = tasks[waitAny].Result;
                    result += arrangements;
                    tasks.RemoveAt(waitAny);
                    inputString.RemoveAt(waitAny);

                    //File.AppendAllLines(outFile, new[] { $"Found {arrangements} arrangements in {elapsedMilliseconds}ms - interim result is {result} with {input.Count} tasks remaining" });
                    printRemaining = true;
                }
                else if (printRemaining)
                {
                    //File.AppendAllLines(outFile, new[] { "Remaining tasks:" }.Concat(input));
                    printRemaining = false;
                }
            }

            Console.WriteLine($"{result} in {timer.ElapsedMilliseconds}ms");

        }
                    private long Arrangements(string pattern, IReadOnlyList<int> sections) =>
                Arrangements(pattern, sections, 0, pattern.Length);

            private long Arrangements(string pattern, IReadOnlyList<int> sections, int patternOffset, int patternLength)
            {
                switch (sections.Count)
                {
                    case 0:
                        return NoSections(pattern, patternOffset, patternLength);
                        break;
                    case 1:
                        return OneSection(pattern, sections[0], patternOffset, patternLength);
                        break;

                    default:
                        return MultipleSections(pattern, sections, patternOffset, patternLength);
                        break;
                };

        }

        private long MultipleSections(string pattern, IReadOnlyList<int> sections, int patternOffset, int patternLength)
            {
                // If there's more than one section, split the sections into three smaller sub-problems
                var leftSections = sections.Take(sections.Count / 2).ToList();
                var pivotSection = sections[sections.Count / 2];
                var rightSections = sections.Skip(sections.Count / 2 + 1).ToList();

                // For each possible position of the pivot section...
                var beforePivotMin = leftSections.Sum() + leftSections.Count - 1;
                var beforePivot = beforePivotMin;
                var slack = patternLength - sections.Sum() - sections.Count + 2;
                long result = 0;
                for (var i = 0; i < slack; i++, beforePivot++)
                {
                    // Check points before and after the pivot section are empty - if not then we're done
                    var afterPivot = beforePivot + 1 + pivotSection;
                    if (pattern[patternOffset + beforePivot] == '#' || (afterPivot < patternLength && pattern[patternOffset + afterPivot] == '#'))
                    {
                        continue;
                    }

                    // Check the pivot section is legally placed - if not then we're done
                    var middle = OneSection(pattern, pivotSection, patternOffset + beforePivot + 1, pivotSection);
                    if (middle == 0)
                    {
                        continue;
                    }

                    // Check how many ways the left section(s) can be placed in the space to the left of the pivot - if none then we're done
                    var left = Arrangements(pattern, leftSections, patternOffset, beforePivot);
                    if (left == 0)
                    {
                        continue;
                    }

                    // Check how many ways the right section(s) can be placed in the space to the right of the pivot
                    var right = Arrangements(pattern, rightSections, patternOffset + afterPivot + 1, patternLength - afterPivot - 1);

                    // Add to the result the combined permutations of left and right
                    result += left * right;
                }

                return result;
            }

            private long OneSection(string pattern, int section, int patternOffset, int patternLength)
            {
                // If there's only one section, then try it in each of its possible positions
                var slack = patternLength - section - 1 + 2;
                long result = 0;
                for (var i = 0; i < slack; i++)
                {
                    var x = 0;
                    var isPossible = true;
                    for (; isPossible && x < i; x++)
                    {
                        if (pattern[patternOffset + x] == '#')
                        {
                            isPossible = false;
                        }
                    }

                    for (; isPossible && x < i + section; x++)
                    {
                        if (pattern[patternOffset + x] == '.')
                        {
                            isPossible = false;
                        }
                    }

                    for (; isPossible && x < patternLength; x++)
                    {
                        if (pattern[patternOffset + x] == '#')
                        {
                            isPossible = false;
                        }
                    }

                    if (isPossible)
                    {
                        // If the position is legal then it counts as one possible arrangement
                        result++;
                    }
                }

                return result;
            }

            private static long NoSections(string pattern, int patternOffset, int patternLength)
            {
                // If there are no sections, check the space can be entirely empty
                for (var x = 0; x < patternLength; x++)
                {
                    if (pattern[patternOffset + x] == '#')
                    {
                        return 0;
                    }
                }

                return 1;
            }
    }
}
